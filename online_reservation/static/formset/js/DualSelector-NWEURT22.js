import{a as E,b as a}from"./chunk-NOGHTXP6.js";import{a as S}from"./chunk-XUU6AKZ7.js";import{a as O,b as T}from"./chunk-DY76DXKL.js";import"./chunk-W5RPWA2M.js";import{a as r}from"./chunk-65OJRBX6.js";import{b as f}from"./chunk-SWW6Z7RX.js";var b=f(O()),y=f(T());var g="django-sortable-select{background-color:rgba(0,0,0,0) !important}django-sortable-select.focus{opacity:1}django-sortable-select option.sortable-selected,django-sortable-select optgroup.sortable-selected{opacity:1;cursor:grab}django-sortable-select option.sortable-chosen,django-sortable-select option.sortable-ghost,django-sortable-select optgroup.sortable-chosen,django-sortable-select optgroup.sortable-ghost{opacity:1;cursor:grabbing !important}django-sortable-select option{display:block;line-height:normal;cursor:default}django-sortable-select option.sortable-chosen,django-sortable-select option.sortable-selected{opacity:1}django-sortable-select optgroup option::before{opacity:1}";a.mount(new E);var h=class extends HTMLElement{constructor(){super();this.baseSelector="django-sortable-select";this.lastSelected=null}initialize(e){r.stylesAreInstalled(this.baseSelector)||this.transferStyles(e),a.create(this,{animation:150,fallbackOnBody:!0,multiDrag:!0,onEnd:t=>this.onEnd(t)}),this.querySelectorAll("optgroup").forEach(t=>{a.create(this,{animation:150,fallbackOnBody:!0,multiDrag:!0,onEnd:s=>this.onEnd(s),handle:">option",group:t.label})}),this.addEventListener("click",t=>this.optionSelected(t)),window.addEventListener("click",t=>this.elementFocus(t))}onEnd(e){this.deselectAllOptions();let t=new Event("options-sorted",{bubbles:!0,cancelable:!0,composed:!1});this.dispatchEvent(t)}elementFocus(e){e.target instanceof HTMLElement&&this.contains(e.target)?this.classList.add("focus"):this.classList.remove("focus")}optionSelected(e){if(!(e.target instanceof HTMLOptionElement))return;let t=e.target;if(e instanceof PointerEvent&&e.metaKey)(t.selected=!t.selected)?a.utils.select(t):a.utils.deselect(t);else if(e instanceof PointerEvent&&e.shiftKey&&this.lastSelected){this.deselectAllOptions();let s=!1;for(let l of this.getElementsByTagName("option"))l===t||l===this.lastSelected?(l.selected=!0,s=!s):l.selected=s,l.selected&&a.utils.select(l)}else this.deselectAllOptions(),t.selected=!0,a.utils.select(t);this.lastSelected=t,e.preventDefault()}deselectAllOptions(){for(let e of this.getElementsByTagName("option"))e.selected=!1,a.utils.deselect(e)}transferStyles(e){let t=document.createElement("style");if(t.innerText=g,document.head.appendChild(t),!t.sheet)throw new Error("Could not create <style> element");let s=t.sheet,l=!1,o=e.querySelector("option");for(let i=0;i<s.cssRules.length;i++){let n=s.cssRules.item(i),c;switch(n.selectorText){case this.baseSelector:c=r.extractStyles(e,["display","width","height","border","box-shadow","outline","overflow","font-family","font-size","font-stretch","font-style","font-weight","letter-spacing","white-space","line-height"]),s.insertRule(`${n.selectorText}{${c}}`,++i),l=!0;break;case`${this.baseSelector}.focus`:e.style.transition="none",e.focus(),c=r.extractStyles(e,["border","box-shadow","outline"]),e.blur(),s.insertRule(`${n.selectorText}{${c}}`,++i),e.style.transition="";break;case`${this.baseSelector} option.sortable-chosen, ${this.baseSelector} option.sortable-selected`:o&&(o.selected=!0,c=r.extractStyles(o,["color","background-color"]),s.insertRule(`${n.selectorText}{${c}}`,++i),o.selected=!1);break;case`${this.baseSelector}.focus option.sortable-chosen, ${this.baseSelector}.focus option.sortable-selected`:e.focus(),o&&(o.selected=!0,c=r.extractStyles(o,["color","background-color"]),s.insertRule(`${n.selectorText}{${c}}`,++i),o.selected=!1),e.blur();break;case`${this.baseSelector} optgroup option::before`:s.insertRule(`${n.selectorText}{content:"\\0000a0\\0000a0\\0000a0\\0000a0";}`,++i);break;default:break}}if(!l)throw new Error(`Could not load styles for ${this.baseSelector}`)}add(e){e instanceof HTMLOptionElement?(this.appendChild(e),a.utils.select(e)):e instanceof HTMLOptGroupElement&&(this.appendChild(e),a.create(e,{animation:150,fallbackOnBody:!0,multiDrag:!0,onEnd:t=>this.onEnd(t),handle:">option"}))}};var p=class extends S{constructor(e,t){var i;super(e);this.historicValues=[];this.historyCursor=0;this.lastRemoteQuery=new URLSearchParams;this.baseSelector='django-formset [role="group"] .dj-dual-selector';this.getValue=()=>this.historicValues[this.historicValues.length-1];this.selectorElement=e,this.containerElement=this.fieldGroup.querySelector(".dj-dual-selector"),e.setAttribute("multiple","multiple");let s=this.fieldGroup.querySelectorAll('input[type="text"]');s.length===2&&(this.searchLeftInput=s[0],this.searchRightInput=s[1],this.searchLeftInput.addEventListener("input",n=>this.leftLookup()),this.searchRightInput.addEventListener("input",n=>this.rightLookup()));let l=this.fieldGroup.querySelectorAll(`select:not([is="${t}"])`);if(l.length>=1)if(this.selectLeftElement=l.item(0),l.length===2)this.selectRightElement=l.item(1);else{let n=this.fieldGroup.querySelector("django-sortable-select");this.selectRightElement=n}else throw new Error(`<select is="${t}"> requires two <select>-elements`);this.moveAllRightButton=this.fieldGroup.querySelector("button.dj-move-all-right"),this.moveSelectedRightButton=this.fieldGroup.querySelector("button.dj-move-selected-right"),this.moveSelectedLeftButton=this.fieldGroup.querySelector("button.dj-move-selected-left"),this.moveAllLeftButton=this.fieldGroup.querySelector("button.dj-move-all-left"),this.undoButton=this.fieldGroup.querySelector("button.dj-undo-selected"),this.redoButton=this.fieldGroup.querySelector("button.dj-redo-selected"),this.selectorElement.classList.add("dj-concealed");let o=(i=e.parentElement)==null?void 0:i.querySelector("template.select-no-results");this.renderNoResults=n=>o?(0,y.default)(o.innerHTML)(n):"No results",r.stylesAreInstalled(this.baseSelector)||this.transferStyles()}installEventHandlers(){var e,t,s,l,o,i;this.selectLeftElement.addEventListener("focus",this.touch),this.selectLeftElement.addEventListener("dblclick",n=>this.moveOptionRight(n.target)),this.selectLeftElement.addEventListener("scroll",n=>this.selectLeftScrolled()),this.selectRightElement.addEventListener("focus",this.touch),this.selectRightElement.addEventListener("dblclick",n=>this.moveOptionLeft(n.target)),this.selectRightElement.addEventListener("options-sorted",n=>this.optionsSorted()),(e=this.moveAllRightButton)==null||e.addEventListener("click",n=>this.moveAllOptionsRight()),(t=this.moveSelectedRightButton)==null||t.addEventListener("click",n=>this.moveSelectedOptionsRight()),(s=this.moveSelectedLeftButton)==null||s.addEventListener("click",n=>this.moveSelectedOptionsLeft()),(l=this.moveAllLeftButton)==null||l.addEventListener("click",n=>this.moveAllOptionsLeft()),(o=this.undoButton)==null||o.addEventListener("click",n=>this.unOrRedo(-1)),(i=this.redoButton)==null||i.addEventListener("click",n=>this.unOrRedo(1))}initialize(){let e=[];this.selectorElement.querySelectorAll(":scope > option").forEach(l=>{let o={id:l.value,label:l.label};l.selected?(this.addOptionToSelectElement(o,this.selectRightElement),e.push(l.value)):this.addOptionToSelectElement(o,this.selectLeftElement),l.replaceChildren()}),this.selectorElement.querySelectorAll(":scope > optgroup").forEach(l=>{l.querySelectorAll("option").forEach(o=>{let i={id:o.value,label:o.label,optgroup:l.label};o.selected?(this.addOptionToSelectElement(i,this.selectRightElement),e.push(o.value)):this.addOptionToSelectElement(i,this.selectLeftElement),o.replaceChildren()}),l.replaceWith(...l.childNodes)}),this.historicValues.push(e),this.setHistoryCursor(0),this.selectRightElement instanceof h&&this.selectRightElement.initialize(this.selectLeftElement),this.setButtonsState(),this.setupFilters(this.selectorElement),this.installEventHandlers()}addNoResultsOption(e,t){let s=new Option(this.renderNoResults({input:t}));s.disabled=!0,e.add(s)}addOptionToSelectElement(e,t){let s=t.querySelector(`option[value="${e.id}"]`);if(s instanceof HTMLOptionElement)return s;let l=new Option(e.label,e.id);if((0,b.default)(e.optgroup)){let o=t.querySelector(`optgroup[label="${e.optgroup}"]`);o||(o=document.createElement("optgroup"),o instanceof HTMLOptGroupElement&&(o.label=e.optgroup,t.add(o))),o.appendChild(l)}else t.add(l);return l}async selectLeftScrolled(){if(!this.isIncomplete)return;this.selectLeftElement.scrollHeight-this.selectLeftElement.scrollTop<=this.selectLeftElement.offsetHeight&&await this.remoteLookup()}async remoteLookup(){var s;let e,t=(s=this.searchLeftInput)==null?void 0:s.value;if(t){let l=this.selectLeftElement.querySelectorAll("option:not([hidden])").length;e=this.buildFetchQuery(l,{search:t})}else e=this.buildFetchQuery(this.selectorElement.childElementCount);this.lastRemoteQuery!==e&&(this.lastRemoteQuery=e,await this.loadOptions(e,l=>l.forEach(o=>{if(!this.selectorElement.querySelector(`option[value="${o.id}"]`)){let i=this.addOptionToSelectElement(o,this.selectLeftElement).cloneNode(!1);this.selectorElement.add(i)}this.setButtonsState()})))}selectorChanged(){var e;this.selectorElement.querySelectorAll("option").forEach(t=>{t.selected=!!this.selectRightElement.querySelector(`option[value="${t.value}"]`)}),this.setButtonsState(),(e=this.containerElement)==null||e.classList.toggle("invalid",!this.selectorElement.checkValidity())}setButtonsState(){let e=!this.selectLeftElement.querySelector("option:not([hidden])");this.moveAllRightButton.disabled=e,this.moveSelectedRightButton.disabled=e,e=!this.selectRightElement.querySelector("option:not([hidden])"),this.moveAllLeftButton.disabled=e,this.moveSelectedLeftButton.disabled=e}clearSearchFields(){var e,t;this.searchLeftInput&&(this.searchLeftInput.value=""),this.searchRightInput&&(this.searchRightInput.value=""),(e=this.selectLeftElement.querySelector("option[disabled]"))==null||e.remove(),(t=this.selectRightElement.querySelector("option[disabled]"))==null||t.remove(),this.selectLeftElement.querySelectorAll("option").forEach(s=>s.hidden=!1),this.selectRightElement.querySelectorAll("option").forEach(s=>s.hidden=!1)}optionsMoved(){let e=Array.from(this.selectRightElement.querySelectorAll("option"));this.historicValues.splice(this.historyCursor+1),this.historicValues.push(e.map(t=>t.value)),this.setHistoryCursor(this.historicValues.length-1),this.selectorChanged(),this.selectorElement.dispatchEvent(new Event("change"))}optionsSorted(){this.selectorElement.querySelectorAll("option:checked").forEach(e=>e.remove()),this.selectRightElement.querySelectorAll("option").forEach(e=>{let t=e.cloneNode(!1);t.selected=!0,this.selectorElement.add(t)}),this.optionsMoved()}moveOptionToSelectElement(e,t){let s=e.parentElement;if(s instanceof HTMLOptGroupElement){let l=t.querySelector(`optgroup[label="${s.label}"]`);if(l instanceof HTMLOptGroupElement)l.appendChild(e),l.hidden=!1;else{let o=document.createElement("optgroup");o.label=s.label,o.appendChild(e),t.add(o)}s.querySelector("option")||s.remove()}else t.add(e)}moveOptionRight(e){e instanceof HTMLOptionElement&&(this.moveOptionToSelectElement(e,this.selectRightElement),this.selectLeftScrolled(),this.hideOptionGroups(this.selectLeftElement),this.optionsMoved())}moveAllOptionsRight(){this.selectLeftElement.querySelectorAll("option:not([hidden])").forEach(e=>{this.moveOptionToSelectElement(e,this.selectRightElement)}),this.clearSearchFields(),this.selectLeftScrolled(),this.optionsMoved()}moveSelectedOptionsRight(){this.selectLeftElement.querySelectorAll("option:checked").forEach(e=>{this.moveOptionToSelectElement(e,this.selectRightElement)}),this.hideOptionGroups(this.selectLeftElement),this.optionsMoved()}moveSelectedOptionsLeft(){this.selectRightElement.querySelectorAll("option:checked").forEach(e=>{this.moveOptionToSelectElement(e,this.selectLeftElement)}),this.hideOptionGroups(this.selectRightElement),this.optionsMoved()}moveAllOptionsLeft(){this.selectRightElement.querySelectorAll("option:not([hidden])").forEach(e=>{this.moveOptionToSelectElement(e,this.selectLeftElement)}),this.clearSearchFields(),this.optionsMoved()}moveOptionLeft(e){e instanceof HTMLOptionElement&&(this.moveOptionToSelectElement(e,this.selectLeftElement),this.hideOptionGroups(this.selectRightElement),this.optionsMoved())}hideOptionGroups(e){e.querySelectorAll("optgroup").forEach(t=>{t.hidden=!t.querySelector("option:not([hidden])")})}leftLookup(){var s;let e=((s=this.searchLeftInput)==null?void 0:s.value)??"",t=this.lookup(this.selectLeftElement,e);this.isIncomplete&&t<this.selectLeftElement.size&&(this.remoteLookup(),t=this.lookup(this.selectLeftElement,e)),this.setButtonsState(),t===0&&this.addNoResultsOption(this.selectLeftElement,e)}rightLookup(){var t;let e=((t=this.searchRightInput)==null?void 0:t.value)??"";this.lookup(this.selectRightElement,e)===0&&this.addNoResultsOption(this.selectRightElement,e)}lookup(e,t){var l;(l=e.querySelector("option[disabled]"))==null||l.remove();let s=e.querySelectorAll("option");if(t){t=t.toLowerCase();let o=0;return s.forEach(i=>{(i.hidden=i.text.toLowerCase().indexOf(t)===-1)&&o++}),this.hideOptionGroups(e),s.length-o}return s.forEach(o=>o.hidden=!1),e.querySelectorAll("optgroup").forEach(o=>o.hidden=!1),s.length}unOrRedo(e){this.clearSearchFields();let t=this.historyCursor+e;if(t<0||t>=this.historicValues.length)return;let s=this.historicValues[t];Array.from(this.selectRightElement.querySelectorAll("option")).filter(i=>s.indexOf(i.value)===-1).forEach(i=>{this.moveOptionToSelectElement(i,this.selectLeftElement)}),Array.from(this.selectLeftElement.querySelectorAll("option")).filter(i=>s.indexOf(i.value)!==-1).forEach(i=>{this.moveOptionToSelectElement(i,this.selectRightElement)}),this.selectRightElement.tagName==="DJANGO-SORTABLE-SELECT"&&(s.forEach(i=>{var c;let n=this.selectRightElement.querySelector(`:scope > option[value="${i}"]`);if(n)this.selectRightElement.insertAdjacentElement("beforeend",n);else{let d=this.selectRightElement.querySelector(`:scope > optgroup > option[value="${i}"]`);d&&((c=d.parentElement)==null||c.insertAdjacentElement("beforeend",d))}}),this.optionsSorted()),this.setHistoryCursor(t),this.selectorChanged(),this.selectorElement.dispatchEvent(new Event("change"))}setHistoryCursor(e){this.historyCursor=e,this.undoButton&&(this.undoButton.disabled=e===0),this.redoButton&&(this.redoButton.disabled=e===this.historicValues.length-1)}transferStyles(){let e=document.createElement("style");if(document.head.appendChild(e),!e.sheet)throw new Error("Could not create <style> element");let t=e.sheet;t.insertRule(`${this.baseSelector}{--dummy-style: none;}`,0);let s=0;this.selectLeftElement.style.transition=this.selectRightElement.style.transition="none",this.selectLeftElement.classList.add("-focus-");let l=r.extractStyles(this.selectLeftElement,["box-shadow"]);t.insertRule(`${this.baseSelector} .left-column:has(>input:focus, >select:focus){${l}}`,++s),t.insertRule(`${this.baseSelector} .left-column>:is(input:focus, select:focus){box-shadow: none; outline: none;}`,++s),l=r.extractStyles(this.selectLeftElement,["border-color","outline"]),t.insertRule(`${this.baseSelector} .left-column:has(>input:focus)>select{${l}}`,++s),t.insertRule(`${this.baseSelector} .left-column:has(>select:focus)>input{${l}}`,++s),this.selectLeftElement.classList.remove("-focus-"),this.searchLeftInput&&(l=r.extractStyles(this.searchLeftInput,["border-top-left-radius","border-top-right-radius"]),t.insertRule(`${this.baseSelector} .left-column{${l}}`,++s)),l=r.extractStyles(this.selectLeftElement,["border-bottom-left-radius","border-bottom-right-radius"]),t.insertRule(`${this.baseSelector} .left-column{${l}}`,++s),this.selectRightElement.classList.add("-focus-"),l=r.extractStyles(this.selectRightElement,["box-shadow"]),t.insertRule(`${this.baseSelector} .right-column:has(> input:focus, >select:focus, >django-sortable-select.focus){${l}}`,++s),t.insertRule(`${this.baseSelector} .right-column>:is(input:focus, select:focus, django-sortable-select.focus){box-shadow: none; outline: none;}`,++s),l=r.extractStyles(this.selectRightElement,["border-color","outline"]),t.insertRule(`${this.baseSelector} .right-column:has(>input:focus)>:is(select, django-sortable-select){${l}}`,++s),t.insertRule(`${this.baseSelector} .right-column:has(>select:focus, django-sortable-select.focus)>input{${l}}`,++s),this.selectRightElement.classList.remove("-focus-"),this.searchRightInput&&(l=r.extractStyles(this.searchRightInput,["border-top-left-radius","border-top-right-radius"]),t.insertRule(`${this.baseSelector} .right-column{${l}}`,++s)),l=r.extractStyles(this.selectRightElement,["border-bottom-left-radius","border-bottom-right-radius"]),t.insertRule(`${this.baseSelector} .right-column{${l}}`,++s),this.selectLeftElement.style.transition=this.selectRightElement.style.transition="",l=r.extractStyles(this.selectLeftElement,["background-color"]),t.insertRule(`${this.baseSelector} .left-column{${l}}`,++s),l=r.extractStyles(this.selectRightElement,["background-color"]),t.insertRule(`${this.baseSelector} .right-column{${l}}`,++s),t.insertRule(`${this.baseSelector} :has(select, input){background-color: transparent;}`,++s),l=r.extractStyles(this.selectLeftElement,["height"]),t.insertRule(`${this.baseSelector} select{${l}}`,++s)}async formResetted(e){var s;this.historicValues.splice(1),this.setHistoryCursor(0),await this.reloadOptions(),this.selectorChanged(),(s=this.containerElement)==null||s.classList.remove("invalid");let t=this.fieldGroup.querySelector(".dj-errorlist > .dj-placeholder");t&&(t.innerHTML="")}formSubmitted(e){this.clearSearchFields(),this.historicValues.splice(0,this.historicValues.length-1),this.setHistoryCursor(0)}async reloadOptions(e){var i;let t=this.getValue();this.selectorElement.replaceChildren(),this.selectLeftElement.replaceChildren(),this.selectRightElement.replaceChildren(),this.clearSearchFields(),this.fieldGroup.classList.remove("dj-dirty","dj-touched","dj-validated"),this.fieldGroup.classList.add("dj-untouched","dj-pristine"),(i=this.containerElement)==null||i.classList.remove("invalid");let s=this.fieldGroup.querySelector(".dj-errorlist > .dj-placeholder");s&&(s.innerHTML=""),await this.remoteLookup(),this.historicValues.splice(1),this.setHistoryCursor(0);let l=!1;Array.from(this.selectLeftElement.querySelectorAll("option")).filter(n=>t.includes(n.value)).forEach(n=>{this.moveOptionToSelectElement(n,this.selectRightElement),l=!0}),l&&this.selectorChanged()}},u=Symbol("DualSelectorElement"),L,v=class extends(L=HTMLSelectElement,u,L){constructor(){super(),this[u]=new p(this,"django-dual-selector")}connectedCallback(){this[u].initialize()}};export{p as DualSelector,v as DualSelectorElement,h as SortableSelectElement};
