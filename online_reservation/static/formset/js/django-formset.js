import{a as wr}from"./chunk-35JSTYG5.js";import{b as pt}from"./chunk-NOGHTXP6.js";import{a as yr,b as vr,c as Er,d as R,e as bt,f as gt}from"./chunk-4WRARRGU.js";import{a as Tr,b as ft}from"./chunk-DY76DXKL.js";import{a as yt}from"./chunk-W5RPWA2M.js";import{a as mt}from"./chunk-65OJRBX6.js";import{a as Pe,b as I,c as w}from"./chunk-SWW6Z7RX.js";var Ft=Pe((Yi,Tt)=>{var Fr="[object AsyncFunction]",Ar="[object Function]",Cr="[object GeneratorFunction]",jr="[object Null]",Lr="[object Proxy]",Sr="[object Undefined]",xr=typeof global=="object"&&global&&global.Object===Object&&global,Pr=typeof self=="object"&&self&&self.Object===Object&&self,Mr=xr||Pr||Function("return this")(),Et=Object.prototype,kr=Et.hasOwnProperty,wt=Et.toString,vt=Mr.Symbol,B=vt?vt.toStringTag:void 0;function Hr(i){return i==null?i===void 0?Sr:jr:B&&B in Object(i)?Ir(i):Or(i)}function Ir(i){var e=kr.call(i,B),t=i[B];try{i[B]=void 0;var r=!0}catch{}var s=wt.call(i);return r&&(e?i[B]=t:delete i[B]),s}function Or(i){return wt.call(i)}function Rr(i){if(!Dr(i))return!1;var e=Hr(i);return e==Ar||e==Cr||e==Fr||e==Lr}function Dr(i){var e=typeof i;return i!=null&&(e=="object"||e=="function")}Tt.exports=Rr});var Lt=Pe((Zi,jt)=>{var Vr="[object Object]";function qr(i){var e=!1;if(i!=null&&typeof i.toString!="function")try{e=!!(i+"")}catch{}return e}function _r(i,e){return function(t){return i(e(t))}}var Br=Function.prototype,At=Object.prototype,Ct=Br.toString,$r=At.hasOwnProperty,Nr=Ct.call(Object),Gr=At.toString,Ur=_r(Object.getPrototypeOf,Object);function zr(i){return!!i&&typeof i=="object"}function Jr(i){if(!zr(i)||Gr.call(i)!=Vr||qr(i))return!1;var e=Ur(i);if(e===null)return!0;var t=$r.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&Ct.call(t)==Nr}jt.exports=Jr});var Bt=Pe((en,_t)=>{var Xr="Expected a function",kt="__lodash_hash_undefined__",Ht=1/0,Kr=9007199254740991,Wr="[object Function]",Qr="[object GeneratorFunction]",Yr="[object Symbol]",Zr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ei=/^\w*$/,ti=/^\./,ri=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ii=/[\\^$.*+?()[\]{}|]/g,ni=/\\(\\)?/g,si=/^\[object .+?Constructor\]$/,oi=/^(?:0|[1-9]\d*)$/,li=typeof global=="object"&&global&&global.Object===Object&&global,ai=typeof self=="object"&&self&&self.Object===Object&&self,ke=li||ai||Function("return this")();function ci(i,e){return i==null?void 0:i[e]}function di(i){var e=!1;if(i!=null&&typeof i.toString!="function")try{e=!!(i+"")}catch{}return e}var ui=Array.prototype,hi=Function.prototype,It=Object.prototype,Me=ke["__core-js_shared__"],St=function(){var i=/[^.]+$/.exec(Me&&Me.keys&&Me.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),Ot=hi.toString,me=It.hasOwnProperty,Rt=It.toString,fi=RegExp("^"+Ot.call(me).replace(ii,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xt=ke.Symbol,pi=ui.splice,mi=Dt(ke,"Map"),ee=Dt(Object,"create"),Pt=xt?xt.prototype:void 0,Mt=Pt?Pt.toString:void 0;function $(i){var e=-1,t=i?i.length:0;for(this.clear();++e<t;){var r=i[e];this.set(r[0],r[1])}}function bi(){this.__data__=ee?ee(null):{}}function gi(i){return this.has(i)&&delete this.__data__[i]}function yi(i){var e=this.__data__;if(ee){var t=e[i];return t===kt?void 0:t}return me.call(e,i)?e[i]:void 0}function vi(i){var e=this.__data__;return ee?e[i]!==void 0:me.call(e,i)}function Ei(i,e){var t=this.__data__;return t[i]=ee&&e===void 0?kt:e,this}$.prototype.clear=bi;$.prototype.delete=gi;$.prototype.get=yi;$.prototype.has=vi;$.prototype.set=Ei;function X(i){var e=-1,t=i?i.length:0;for(this.clear();++e<t;){var r=i[e];this.set(r[0],r[1])}}function wi(){this.__data__=[]}function Ti(i){var e=this.__data__,t=be(e,i);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():pi.call(e,t,1),!0}function Fi(i){var e=this.__data__,t=be(e,i);return t<0?void 0:e[t][1]}function Ai(i){return be(this.__data__,i)>-1}function Ci(i,e){var t=this.__data__,r=be(t,i);return r<0?t.push([i,e]):t[r][1]=e,this}X.prototype.clear=wi;X.prototype.delete=Ti;X.prototype.get=Fi;X.prototype.has=Ai;X.prototype.set=Ci;function N(i){var e=-1,t=i?i.length:0;for(this.clear();++e<t;){var r=i[e];this.set(r[0],r[1])}}function ji(){this.__data__={hash:new $,map:new(mi||X),string:new $}}function Li(i){return ge(this,i).delete(i)}function Si(i){return ge(this,i).get(i)}function xi(i){return ge(this,i).has(i)}function Pi(i,e){return ge(this,i).set(i,e),this}N.prototype.clear=ji;N.prototype.delete=Li;N.prototype.get=Si;N.prototype.has=xi;N.prototype.set=Pi;function Mi(i,e,t){var r=i[e];(!(me.call(i,e)&&Vt(r,t))||t===void 0&&!(e in i))&&(i[e]=t)}function be(i,e){for(var t=i.length;t--;)if(Vt(i[t][0],e))return t;return-1}function ki(i){if(!pe(i)||qi(i))return!1;var e=Ni(i)||di(i)?fi:si;return e.test($i(i))}function Hi(i,e,t,r){if(!pe(i))return i;e=Di(e,i)?[e]:Oi(e);for(var s=-1,n=e.length,o=n-1,u=i;u!=null&&++s<n;){var d=Bi(e[s]),a=t;if(s!=o){var l=u[d];a=r?r(l,d,u):void 0,a===void 0&&(a=pe(l)?l:Ri(e[s+1])?[]:{})}Mi(u,d,a),u=u[d]}return i}function Ii(i){if(typeof i=="string")return i;if(Ie(i))return Mt?Mt.call(i):"";var e=i+"";return e=="0"&&1/i==-Ht?"-0":e}function Oi(i){return qt(i)?i:_i(i)}function ge(i,e){var t=i.__data__;return Vi(e)?t[typeof e=="string"?"string":"hash"]:t.map}function Dt(i,e){var t=ci(i,e);return ki(t)?t:void 0}function Ri(i,e){return e=e??Kr,!!e&&(typeof i=="number"||oi.test(i))&&i>-1&&i%1==0&&i<e}function Di(i,e){if(qt(i))return!1;var t=typeof i;return t=="number"||t=="symbol"||t=="boolean"||i==null||Ie(i)?!0:ei.test(i)||!Zr.test(i)||e!=null&&i in Object(e)}function Vi(i){var e=typeof i;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?i!=="__proto__":i===null}function qi(i){return!!St&&St in i}var _i=He(function(i){i=Ui(i);var e=[];return ti.test(i)&&e.push(""),i.replace(ri,function(t,r,s,n){e.push(s?n.replace(ni,"$1"):r||t)}),e});function Bi(i){if(typeof i=="string"||Ie(i))return i;var e=i+"";return e=="0"&&1/i==-Ht?"-0":e}function $i(i){if(i!=null){try{return Ot.call(i)}catch{}try{return i+""}catch{}}return""}function He(i,e){if(typeof i!="function"||e&&typeof e!="function")throw new TypeError(Xr);var t=function(){var r=arguments,s=e?e.apply(this,r):r[0],n=t.cache;if(n.has(s))return n.get(s);var o=i.apply(this,r);return t.cache=n.set(s,o),o};return t.cache=new(He.Cache||N),t}He.Cache=N;function Vt(i,e){return i===e||i!==i&&e!==e}var qt=Array.isArray;function Ni(i){var e=pe(i)?Rt.call(i):"";return e==Wr||e==Qr}function pe(i){var e=typeof i;return!!i&&(e=="object"||e=="function")}function Gi(i){return!!i&&typeof i=="object"}function Ie(i){return typeof i=="symbol"||Gi(i)&&Rt.call(i)==Yr}function Ui(i){return i==null?"":Ii(i)}function zi(i,e,t){return i==null?i:Hi(i,e,t)}_t.exports=zi});(function(){"use strict";var i=function(h,c){var f=function(E){for(var b=0,v=E.length;b<v;b++)p(E[b])},p=function(E){var b=E.target,v=E.attributeName,A=E.oldValue;b.attributeChangedCallback(v,A,b.getAttribute(v))};return function(m,E){var b=m.constructor.observedAttributes;return b&&h(E).then(function(){new c(f).observe(m,{attributes:!0,attributeOldValue:!0,attributeFilter:b});for(var v=0,A=b.length;v<A;v++)m.hasAttribute(b[v])&&p({target:m,attributeName:b[v],oldValue:null})}),m}};function e(h,c){if(h){if(typeof h=="string")return t(h,c);var f=Object.prototype.toString.call(h).slice(8,-1);if(f==="Object"&&h.constructor&&(f=h.constructor.name),f==="Map"||f==="Set")return Array.from(h);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return t(h,c)}}function t(h,c){(c==null||c>h.length)&&(c=h.length);for(var f=0,p=new Array(c);f<c;f++)p[f]=h[f];return p}function r(h,c){var f=typeof Symbol<"u"&&h[Symbol.iterator]||h["@@iterator"];if(!f){if(Array.isArray(h)||(f=e(h))||c&&h&&typeof h.length=="number"){f&&(h=f);var p=0,m=function(){};return{s:m,n:function(){return p>=h.length?{done:!0}:{done:!1,value:h[p++]}},e:function(A){throw A},f:m}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var E=!0,b=!1,v;return{s:function(){f=f.call(h)},n:function(){var A=f.next();return E=A.done,A},e:function(A){b=!0,v=A},f:function(){try{!E&&f.return!=null&&f.return()}finally{if(b)throw v}}}}var s=!0,n=!1,o="querySelectorAll",u=function(c){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:document,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:MutationObserver,m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:["*"],E=function A(q,_,S,g,F,C){var x=r(q),J;try{for(x.s();!(J=x.n()).done;){var j=J.value;(C||o in j)&&(F?S.has(j)||(S.add(j),g.delete(j),c(j,F)):g.has(j)||(g.add(j),S.delete(j),c(j,F)),C||A(j[o](_),_,S,g,F,s))}}catch(xe){x.e(xe)}finally{x.f()}},b=new p(function(A){if(m.length){var q=m.join(","),_=new Set,S=new Set,g=r(A),F;try{for(g.s();!(F=g.n()).done;){var C=F.value,x=C.addedNodes,J=C.removedNodes;E(J,q,_,S,n,n),E(x,q,_,S,s,n)}}catch(j){g.e(j)}finally{g.f()}}}),v=b.observe;return(b.observe=function(A){return v.call(b,A,{subtree:s,childList:s})})(f),b},d="querySelectorAll",a=self,l=a.document,L=a.Element,z=a.MutationObserver,ne=a.Set,Qt=a.WeakMap,Ge=function(c){return d in c},Ue=[].filter,we=function(h){var c=new Qt,f=function(g){for(var F=0,C=g.length;F<C;F++)c.delete(g[F])},p=function(){for(var g=q.takeRecords(),F=0,C=g.length;F<C;F++)b(Ue.call(g[F].removedNodes,Ge),!1),b(Ue.call(g[F].addedNodes,Ge),!0)},m=function(g){return g.matches||g.webkitMatchesSelector||g.msMatchesSelector},E=function(g,F){var C;if(F)for(var x,J=m(g),j=0,xe=v.length;j<xe;j++)J.call(g,x=v[j])&&(c.has(g)||c.set(g,new ne),C=c.get(g),C.has(x)||(C.add(x),h.handle(g,F,x)));else c.has(g)&&(C=c.get(g),c.delete(g),C.forEach(function(gr){h.handle(g,F,gr)}))},b=function(g){for(var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,C=0,x=g.length;C<x;C++)E(g[C],F)},v=h.query,A=h.root||l,q=u(E,A,z,v),_=L.prototype.attachShadow;return _&&(L.prototype.attachShadow=function(S){var g=_.call(this,S);return q.observe(g),g}),v.length&&b(A[d](v)),{drop:f,flush:p,observer:q,parse:b}},P=self,M=P.document,V=P.Map,ze=P.MutationObserver,se=P.Object,Je=P.Set,Yt=P.WeakMap,Xe=P.Element,Zt=P.HTMLElement,Ke=P.Node,We=P.Error,Qe=P.TypeError,er=P.Reflect,oe=se.defineProperty,tr=se.keys,rr=se.getOwnPropertyNames,Q=se.setPrototypeOf,Y=!self.customElements,Ye=function(c){for(var f=tr(c),p=[],m=new Je,E=f.length,b=0;b<E;b++){p[b]=c[f[b]];try{delete c[f[b]]}catch{m.add(b)}}return function(){for(var v=0;v<E;v++)m.has(v)||(c[f[v]]=p[v])}};if(Y){var Te=function(){var c=this.constructor;if(!Fe.has(c))throw new Qe("Illegal constructor");var f=Fe.get(c);if(ae)return rt(ae,f);var p=Ze.call(M,f);return rt(Q(p,c.prototype),f)},Ze=M.createElement,Fe=new V,le=new V,et=new V,Z=new V,tt=[],ir=function(c,f,p){var m=et.get(p);if(f&&!m.isPrototypeOf(c)){var E=Ye(c);ae=Q(c,m);try{new m.constructor}finally{ae=null,E()}}var b="".concat(f?"":"dis","connectedCallback");b in m&&c[b]()},nr=we({query:tt,handle:ir}),sr=nr.parse,ae=null,Ae=function(c){if(!le.has(c)){var f,p=new Promise(function(m){f=m});le.set(c,{$:p,_:f})}return le.get(c).$},rt=i(Ae,ze);self.customElements={define:function(c,f){if(Z.has(c))throw new We('the name "'.concat(c,'" has already been used with this registry'));Fe.set(f,c),et.set(c,f.prototype),Z.set(c,f),tt.push(c),Ae(c).then(function(){sr(M.querySelectorAll(c))}),le.get(c)._(f)},get:function(c){return Z.get(c)},whenDefined:Ae},oe(Te.prototype=Zt.prototype,"constructor",{value:Te}),self.HTMLElement=Te,M.createElement=function(h,c){var f=c&&c.is,p=f?Z.get(f):Z.get(h);return p?new p:Ze.call(M,h)},"isConnected"in Ke.prototype||oe(Ke.prototype,"isConnected",{configurable:!0,get:function(){return!(this.ownerDocument.compareDocumentPosition(this)&this.DOCUMENT_POSITION_DISCONNECTED)}})}else if(Y=!self.customElements.get("extends-br"),Y)try{var it=function h(){return self.Reflect.construct(HTMLBRElement,[],h)};it.prototype=HTMLLIElement.prototype;var nt="extends-br";self.customElements.define("extends-br",it,{extends:"br"}),Y=M.createElement("br",{is:nt}).outerHTML.indexOf(nt)<0;var st=self.customElements,or=st.get,lr=st.whenDefined;self.customElements.whenDefined=function(h){var c=this;return lr.call(this,h).then(function(f){return f||or.call(c,h)})}}catch{}if(Y){var ot=function(c){var f=Ce.get(c);ut(f.querySelectorAll(this),c.isConnected)},H=self.customElements,lt=M.createElement,ar=H.define,cr=H.get,dr=H.upgrade,ur=er||{construct:function(c){return c.call(this)}},hr=ur.construct,Ce=new Yt,je=new Je,ce=new V,de=new V,at=new V,ue=new V,ct=[],he=[],dt=function(c){return ue.get(c)||cr.call(H,c)},fr=function(c,f,p){var m=at.get(p);if(f&&!m.isPrototypeOf(c)){var E=Ye(c);fe=Q(c,m);try{new m.constructor}finally{fe=null,E()}}var b="".concat(f?"":"dis","connectedCallback");b in m&&c[b]()},pr=we({query:he,handle:fr}),ut=pr.parse,mr=we({query:ct,handle:function(c,f){Ce.has(c)&&(f?je.add(c):je.delete(c),he.length&&ot.call(he,c))}}),br=mr.parse,ht=Xe.prototype.attachShadow;ht&&(Xe.prototype.attachShadow=function(h){var c=ht.call(this,h);return Ce.set(this,c),c});var Le=function(c){if(!de.has(c)){var f,p=new Promise(function(m){f=m});de.set(c,{$:p,_:f})}return de.get(c).$},Se=i(Le,ze),fe=null;rr(self).filter(function(h){return/^HTML.*Element$/.test(h)}).forEach(function(h){var c=self[h];function f(){var p=this.constructor;if(!ce.has(p))throw new Qe("Illegal constructor");var m=ce.get(p),E=m.is,b=m.tag;if(E){if(fe)return Se(fe,E);var v=lt.call(M,b);return v.setAttribute("is",E),Se(Q(v,p.prototype),E)}else return hr.call(this,c,[],p)}oe(f.prototype=c.prototype,"constructor",{value:f}),oe(self,h,{value:f})}),M.createElement=function(h,c){var f=c&&c.is;if(f){var p=ue.get(f);if(p&&ce.get(p).tag===h)return new p}var m=lt.call(M,h);return f&&m.setAttribute("is",f),m},H.get=dt,H.whenDefined=Le,H.upgrade=function(h){var c=h.getAttribute("is");if(c){var f=ue.get(c);if(f){Se(Q(h,f.prototype),c);return}}dr.call(H,h)},H.define=function(h,c,f){if(dt(h))throw new We("'".concat(h,"' has already been defined as a custom element"));var p,m=f&&f.extends;ce.set(c,m?{is:h,tag:m}:{is:"",tag:h}),m?(p="".concat(m,'[is="').concat(h,'"]'),at.set(p,c.prototype),ue.set(h,c),he.push(p)):(ar.apply(H,arguments),ct.push(p=h)),Le(h).then(function(){m?(ut(M.querySelectorAll(p)),je.forEach(ot,[p])):br(M.querySelectorAll(p))}),de.get(h)._(c)}}})();var D=I(yr()),G=I(vr()),Jt=I(Er()),re=I(wr()),ie=I(Ft()),Xt=I(Lt()),k=I(Tr()),Oe=I(Bt()),Kt=I(ft());var $t=I(ft()),ye=class{constructor(e,t){this.progressBar=null;this.fileDrop=e=>{if(this.swallowEvent(e),e.dataTransfer){for(let t of e.dataTransfer.files)if(!this.matchesMimeType(t.type)){e.dataTransfer.clearData(),this.fieldGroup.reportFailedUpload();return}this.fieldGroup.touch(),this.inputElement.files=e.dataTransfer.files,this.uploadFiles(this.inputElement.files).then(()=>{this.fieldGroup.inputted(),this.fieldGroup.validate()})}};this.fileRemove=()=>{for(this.inputElement.value="",this.uploadedFiles=this.initialData.length>0?[{}]:[];this.dropbox.firstChild;)this.dropbox.removeChild(this.dropbox.firstChild);this.dropbox.appendChild(this.emptyDropboxItem),this.fieldGroup.touch(),this.fieldGroup.inputted(),this.fieldGroup.validate()};this.swallowEvent=e=>{e.stopPropagation(),e.preventDefault()};if(this.fieldGroup=e,this.inputElement=t,this.maxUploadSize=parseInt(this.inputElement.getAttribute("max-size")??"0"),this.dropbox=this.fieldGroup.element.querySelector("figure.dj-dropbox"),!this.dropbox)throw new Error('Element <input type="file"> requires sibling element <figure class="dj-dropbox"></figure>');if(this.chooseFileButton=this.fieldGroup.element.querySelector("button.dj-choose-file"),!this.chooseFileButton)throw new Error('Element <input type="file"> requires sibling element <button class="dj-choose-file"></button>');if(this.progressBar=this.fieldGroup.element.querySelector("progress"),this.progressBar&&(this.progressBar.style.visibility="hidden"),this.emptyDropboxItem=this.dropbox.querySelector("div.dj-empty-item"),!this.emptyDropboxItem)throw new Error('Element <input type="file"> requires sibling element <figure><div class="dj-empty-item"></div></figure>');let r=this.fieldGroup.element.querySelector(".dj-dropbox-items");if(!r)throw new Error('Element <input type="file"> requires sibling element <template class="dj-dropbox-items"></template>');this.dropboxItemTemplate=(0,$t.default)(r.innerHTML),this.observer=new MutationObserver(n=>this.attributesChanged(n)),this.observer.observe(this.inputElement,{attributes:!0}),this.chooseFileButton.disabled=t.disabled;let s=document.getElementById(`initial_${t.id}`);s!=null&&s.textContent?(this.uploadedFiles=this.initialData=[JSON.parse(s.textContent)],this.renderDropbox()):this.uploadedFiles=this.initialData=[],this.dropbox.addEventListener("dragenter",this.swallowEvent),this.dropbox.addEventListener("dragover",this.swallowEvent),this.dropbox.addEventListener("drop",this.fileDrop),this.chooseFileButton.addEventListener("click",()=>{t.click()}),t.addEventListener("change",()=>this.uploadFiles(this.inputElement.files).then(()=>{this.fieldGroup.inputted(),this.fieldGroup.validate()}).catch(()=>{this.fieldGroup.reportFailedUpload()}).finally(()=>{this.chooseFileButton.blur(),this.fieldGroup.touch()}))}matchesMimeType(e){let t=this.inputElement.accept.split(",").map(n=>n.trim());if(t.length===0)return!0;let[r,s]=e.split("/");for(let n of t)if(n===e||s==="*"&&n.split("/")[0]===r)return!0;return!1}async uploadFiles(e){return!e||e.length===0?Promise.reject():new Promise((t,r)=>{let s=e.item(0);s&&(!this.maxUploadSize||s.size<=this.maxUploadSize)?this.uploadFile(s,this.dropbox.clientHeight).then(n=>{this.uploadedFiles=[n],this.renderDropbox(),this.fieldGroup.inputted(),this.inputElement.dataset.fileupload=JSON.stringify(n),t()}).catch(()=>{r()}):r()})}async uploadFile(e,t){let r=this;function s(o){let u=o.lengthComputable?o.loaded/o.total:0;r.progressBar&&(r.progressBar.style.visibility="visible",r.progressBar.value=.97*u)}let n=new FormData;return n.append("temp_file",e),n.append("image_height",t.toString()),new Promise((o,u)=>{function d(){r.progressBar&&(r.progressBar.value=1,window.setTimeout(()=>r.progressBar.style.visibility="hidden",333)),a.status===200?o(a.response):u(a.response)}let a=new XMLHttpRequest;r.progressBar&&(a.addEventListener("loadstart",s),a.upload.addEventListener("progress",s,!1)),a.addEventListener("loadend",d),a.open("POST",this.fieldGroup.form.formset.endpoint,!0);let l=this.fieldGroup.form.formset.CSRFToken;l&&a.setRequestHeader("X-CSRFToken",l),a.responseType="json",a.send(n)})}renderDropbox(){let e=this.uploadedFiles.map(this.dropboxItemTemplate);e.length>0?(this.dropbox.innerHTML=e.join(""),this.inputElement.dataset.fileupload=JSON.stringify(this.uploadedFiles[0])):this.dropbox.replaceChildren(this.emptyDropboxItem)}attributesChanged(e){for(let t of e)if(t.type==="attributes"&&(t.attributeName==="disabled"&&this.chooseFileButton.disabled!=this.inputElement.disabled&&(this.chooseFileButton.disabled=this.inputElement.disabled),t.attributeName==="data-fileupload")){let r=this.inputElement.dataset.fileupload;if(r){this.dropbox.innerHTML=this.dropboxItemTemplate(JSON.parse(r));let s=this.dropbox.querySelector(".dj-delete-file");s&&s.addEventListener("click",this.fileRemove,{once:!0})}}}inProgress(){return!!this.inputElement.files&&this.inputElement.files.length>0&&!this.uploadedFiles.length}resetToInitial(){this.uploadedFiles=this.initialData,this.renderDropbox()}};var Nt=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
	<g class="spinner">
		<path style="stroke-width:0.729" d="m 12.73285,23.212276 -10e-7,-4.393157 A 0.27932072,0.27932072 0 0 0 12.27476,18.604602 l -2.6367848,2.196577 a 0.27932072,0.27932072 0 0 0 -10e-8,0.429037 l 2.6367859,2.196577 a 0.27932072,0.27932072 0 0 0 0.458089,-0.214517 z" />
		<path style="stroke-width:0.729" d="m 11.298326,5.191792 -10e-7,-4.39315704 a 0.27932072,0.27932072 0 0 1 0.458086,-0.214519 L 14.393193,2.780699 a 0.27932072,0.27932072 0 0 1 2e-6,0.429033 l -2.636785,2.19658 a 0.27932072,0.27932072 0 0 1 -0.458084,-0.21452 z" />
		<path style="fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-miterlimit:10;stroke-dashoffset:89.339;stroke-dasharray:none" d="M 12.5,2.9179688 C 12.333705,2.9010187 12.166975,2.8886442 12,2.8808594 6.9635919,2.8807514 2.8807499,6.9635934 2.8808594,12 c 0.00661,2.530252 1.064217,4.944009 2.9199218,6.664062" />
		<path style="fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-miterlimit:10;stroke-dashoffset:89.339;stroke-dasharray:none" d="m 11.458261,21.082031 c 0.166295,0.01695 0.333025,0.02933 0.5,0.03711 C 16.994669,21.119249 21.077511,17.036407 21.077402,12 21.070802,9.469748 20.013185,7.055991 18.15748,5.335938" />
	</g>
</svg>
`;var Gt=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
	<circle class="path circle" fill="none" stroke="currentColor" stroke-width="1.93833" stroke-miterlimit="10" cx="12.000002" cy="12.000002" r="10.030837" />
	<polyline class="path check" fill="none" stroke="currentColor" stroke-width="12" stroke-linecap="round" stroke-miterlimit="10" points="100.2,40.2 51.5,88.8 29.8,67.5 " transform="matrix(0.18,0,0,0.18,-0.284,0.544)" />
</svg>
`;var Ut=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
	<circle class="path circle" fill="none" stroke="currentColor" stroke-width="1.93833" stroke-miterlimit="10" cx="12.000002" cy="12.000002" r="10.030837" />
	<line class="path line" fill="none" stroke="currentColor" stroke-width="2.12533" stroke-linecap="round" stroke-miterlimit="10" x1="6.562665" y1="7.1626649" x2="17.437328" y2="16.79755" />
	<line class="path line" fill="none" stroke="currentColor" stroke-width="2.12534" stroke-linecap="round" stroke-miterlimit="10" x1="17.437338" y1="7.1626701" x2="6.5626698" y2="16.762127" />
</svg>
`;var Re="__all__",Wi="_collection_errors_",Qi="_marked_for_removal_",Wt=document.createElement("style");Wt.innerText=bt;document.head.appendChild(Wt);var De=class{constructor(e){this.value=e}},Ve=class{constructor(e,t){this.form=e,this.element=t,this.errorPlaceholder=t.querySelector(".dj-errorlist > .dj-placeholder"),this.errorMessages=new yt(t);let r=t.classList.contains("dj-required-any"),s=l=>l instanceof HTMLInputElement&&l.name&&l.form===e.element&&l.type!=="hidden",n=Array.from(t.getElementsByTagName("INPUT")).filter(s);for(let l of n)switch(l.type){case"checkbox":case"radio":l.addEventListener("input",()=>{this.touch(),this.inputted()}),l.addEventListener("change",()=>{r?this.validateCheckboxSelectMultiple():this.validate()});break;case"file":this.fileUploader=new ye(this,l),l.addEventListener("invalid",()=>this.showErrorMessage(l));break;default:l.addEventListener("focus",()=>this.touch()),l.addEventListener("input",()=>this.inputted()),l.addEventListener("blur",()=>this.validate()),l.addEventListener("invalid",()=>this.showErrorMessage(l));break}this.fieldElements=Array(0).concat(n);let o=l=>l instanceof HTMLSelectElement&&l.name&&l.form===e.element,u=Array.from(t.getElementsByTagName("SELECT")).filter(o).at(0);u instanceof HTMLSelectElement&&(u.addEventListener("focus",()=>this.touch()),u.addEventListener("change",()=>{this.setDirty(),this.clearCustomError(),this.validate()}),u.addEventListener("invalid",()=>this.showErrorMessage(u)),this.fieldElements.push(u));let d=l=>l instanceof HTMLTextAreaElement&&l.name&&l.form===e.element,a=Array.from(t.getElementsByTagName("TEXTAREA")).filter(d).at(0);a instanceof HTMLTextAreaElement&&(a.addEventListener("focus",()=>this.touch()),a.addEventListener("input",()=>this.inputted()),a.addEventListener("blur",()=>this.validate()),a.addEventListener("invalid",()=>this.showErrorMessage(a)),this.fieldElements.push(a)),this.name=this.assertUniqueName(),this.initialDisabled=this.fieldElements.map(l=>l.disabled),this.initialRequired=this.fieldElements.map(l=>l.required),r?this.validateCheckboxSelectMultiple():this.validateBoundField(),this.pristineValue=new De(this.aggregateValue()),this.updateVisibility=this.evalVisibility("df-show",!0)??this.evalVisibility("df-hide",!1)??function(){},this.updateDisabled=this.evalDisable(),this.updateRequired=this.evalRequire(),this.untouch(),this.setPristine()}aggregateValue(){var e,t;if(this.fieldElements.length===1){let r=this.fieldElements[0];if(r.type==="checkbox")return r.checked?r.value:"";if(r.type==="select-multiple"){let s=r;return Array.from(s.selectedOptions).map(n=>n.value)}if(r.type==="file")return this.fileUploader.uploadedFiles;if(r instanceof HTMLInputElement){if(window.customElements.get("django-datefield")&&r.getAttribute("is")==="django-datefield"||window.customElements.get("django-datecalendar")&&r.getAttribute("is")==="django-datecalendar"||window.customElements.get("django-datepicker")&&r.getAttribute("is")==="django-datepicker")return((e=r.valueAsDate)==null?void 0:e.toISOString().slice(0,10))??"";if(window.customElements.get("django-datetimefield")&&r.getAttribute("is")==="django-datetimefield"||window.customElements.get("django-datetimecalendar")&&r.getAttribute("is")==="django-datetimecalendar"||window.customElements.get("django-datetimepicker")&&r.getAttribute("is")==="django-datetimepicker")return((t=r.valueAsDate)==null?void 0:t.toISOString().replace("T"," ").slice(0,16))??"";if(window.customElements.get("django-daterangefield")&&r.getAttribute("is")==="django-daterangefield"||window.customElements.get("django-daterangecalendar")&&r.getAttribute("is")==="django-daterangecalendar"||window.customElements.get("django-daterangepicker")&&r.getAttribute("is")==="django-daterangepicker")return r.value?r.value.split(";").map(s=>s.slice(0,10)):["",""];if(window.customElements.get("django-datetimerangefield")&&r.getAttribute("is")==="django-datetimerangefield"||window.customElements.get("django-datetimerangecalendar")&&r.getAttribute("is")==="django-datetimerangecalendar"||window.customElements.get("django-datetimerangepicker")&&r.getAttribute("is")==="django-datetimerangepicker")return r.value?r.value.split(";").map(s=>s.slice(0,16)):["",""]}return r.value}else{let r=[];for(let s of this.fieldElements)if(s.type==="checkbox")s.checked&&r.push(s.value);else if(s.type==="radio"&&s.checked)return s.value;return r}}setFieldValue(e){if(this.fieldElements.length===1){let t=this.fieldElements[0];if(t.type==="checkbox")t.checked=e===t.value;else if(t.type==="select-multiple"){let r=t,s=Array.from(r.options).filter(n=>e.includes(n.value));for(let n of s)n.selected=!0}else t.type!=="file"&&(t.value=e)}else{let t=e;for(let r of this.fieldElements)r.type==="checkbox"&&(r.checked=t.includes(r.value))}this.validate()}updateOperability(...e){this.updateVisibility(),this.updateDisabled(),this.updateRequired(),this.fieldElements.filter(t=>(0,ie.default)(t.updateOperability)).forEach(t=>t.updateOperability(...e))}disableRequiredConstraint(){this.fieldElements.forEach(e=>e.required=!1)}restoreRequiredConstraint(){this.fieldElements.forEach((e,t)=>e.required=this.initialRequired[t])}assertUniqueName(){let e="__undefined__";for(let t of this.fieldElements)if(e==="__undefined__")e=t.name;else if(e!==t.name)throw new Error(`Duplicate name '${e}' on multiple input fields on '${t.name}'`);return e}evalVisibility(e,t){var n;function r(o){return Array.isArray(o)?o.length!==0:!!o}let s=(n=this.fieldElements[0])==null?void 0:n.getAttribute(e);if(!(0,k.default)(s))return null;try{let o=new Function(`return ${R(s,{startRule:"OperabilityExpression"})};`);return()=>{let u=t!=r(o.call(this));this.element.hasAttribute("hidden")!==u&&(this.fieldElements.forEach((d,a)=>d.disabled=u||this.initialDisabled[a]),this.element.toggleAttribute("hidden",u))}}catch(o){throw new Error(`Error while parsing <... df-show/hide="${s}">: ${o}.`)}}evalDisable(){var t;let e=(t=this.fieldElements[0])==null?void 0:t.getAttribute("df-disable");if(!(0,k.default)(e))return()=>{};try{let r=new Function("return "+R(e,{startRule:"OperabilityExpression"}));return()=>{let s=r.call(this);this.fieldElements.forEach((n,o)=>n.disabled=s||this.initialDisabled[o])}}catch(r){throw new Error(`Error while parsing <... df-disable="${e}">: ${r}.`)}}evalRequire(){var t;let e=(t=this.fieldElements[0])==null?void 0:t.getAttribute("df-require");if(!(0,k.default)(e))return()=>{};try{let r=new Function("return "+R(e,{startRule:"OperabilityExpression"}));return()=>{let s=r.call(this);this.fieldElements.forEach((n,o)=>n.required=s&&this.initialRequired[o]),this.form.checkValidity()}}catch(r){throw new Error(`Error while parsing <... df-require="${e}">: ${r}.`)}}getDataValue(e){return this.form.getDataValue(e)}inputted(){(0,G.default)(this.pristineValue,this.aggregateValue())?this.setPristine():this.setDirty(),this.clearCustomError(),this.form.restoreRequiredConstraints()}clearCustomError(){this.form.clearCustomErrors(),this.errorPlaceholder&&(this.errorPlaceholder.innerHTML="");for(let e of this.fieldElements)e.validity.customError&&e.setCustomValidity("")}resetToInitial(){var e;(e=this.fileUploader)==null||e.resetToInitial(),this.untouch(),this.setPristine(),this.clearCustomError()}disableAllFields(){this.fieldElements.forEach(e=>e.disabled=!0)}reenableAllFields(){this.fieldElements.forEach((e,t)=>e.disabled=this.initialDisabled[t])}touch(){this.element.classList.remove("dj-untouched","dj-validated"),this.element.classList.add("dj-touched")}untouch(){this.element.classList.remove("dj-submitted","dj-touched"),this.element.classList.add("dj-untouched"),this.errorPlaceholder&&(this.errorPlaceholder.innerHTML="")}setDirty(){this.element.classList.remove("dj-submitted","dj-pristine"),this.element.classList.add("dj-dirty")}setPristine(){this.element.classList.remove("dj-dirty"),this.element.classList.add("dj-pristine")}get isPristine(){return this.element.classList.contains("dj-pristine")}get isTouched(){return this.element.classList.contains("dj-touched")}setSubmitted(){this.element.classList.add("dj-submitted")}showErrorMessage(e){let t=this.element.classList.contains("dj-submitted");if(!(!(this.isTouched||t)||!this.form.formset.showFeedbackMessages||!this.errorPlaceholder))for(let[r,s]of this.errorMessages)e.validity[r]&&(this.errorPlaceholder.innerHTML=s)}validate(){let e=null;for(e of this.fieldElements)if(e instanceof HTMLInputElement&&e.hasAttribute("is")&&e.checkValidity(),!e.validity.valid)break;e&&!e.validity.valid&&(e.dispatchEvent(new Event("invalid",{bubbles:!0})),e instanceof HTMLInputElement&&e.type==="file"&&this.validateFileInput(e,this.form.formset.showFeedbackMessages)),this.form.validate()}validateCheckboxSelectMultiple(){let e=!1;for(let t of this.fieldElements){if(t.type!=="checkbox")throw new Error("Expected input element of type 'checkbox'.");t.checked?e=!0:t.setCustomValidity(this.errorMessages.get("customError")??"")}if(e)for(let t of this.fieldElements)t.setCustomValidity("");else this.pristineValue!==void 0&&this.errorPlaceholder&&this.form.formset.showFeedbackMessages&&(this.errorPlaceholder.innerHTML=this.errorMessages.get("customError")??"");return this.form.validate(),e}validateFileInput(e,t){return this.fileUploader.inProgress()?(this.errorPlaceholder&&t&&(this.errorPlaceholder.innerHTML=this.errorMessages.get("typeMismatch")??""),!1):!0}validateBoundField(){if(this.fieldElements.length!==1||!(this.fieldElements[0]instanceof HTMLInputElement))return;let e=this.fieldElements[0];if(e.value&&e.type==="text"){if(e.minLength>0&&e.value.length<e.minLength)return e.setCustomValidity(this.errorMessages.get("tooShort")??"");if(e.maxLength>0&&e.value.length>e.maxLength)return e.setCustomValidity(this.errorMessages.get("tooLong")??"")}}setValidationError(){let e=null;for(e of this.fieldElements)if(!e.validity.valid)break;for(let[t,r]of this.errorMessages)if(e&&e.validity[t])return this.errorPlaceholder&&(this.errorPlaceholder.innerHTML=r,e.setCustomValidity(r)),!1;return e instanceof HTMLInputElement&&e.type==="file"?this.validateFileInput(e,!0):!0}reportCustomError(e){this.errorPlaceholder&&(this.errorPlaceholder.innerHTML=e),this.fieldElements[0].setCustomValidity(e)}reportFailedUpload(){this.errorPlaceholder&&(this.errorPlaceholder.innerHTML=this.errorMessages.get("badInput")??"File upload failed")}},te=class{constructor(e,t){this.func=e,this.args=t}},W=class{constructor(e,t){this.successChain=e,this.rejectChain=t}},qe=class{constructor(e,t,r){this.condition=e,this.fulfilled=t,this.otherwise=r}};function T(i,e,t){let r=t.value;return t.value=function(...s){let n=r.apply(this,s);return(0,ie.default)(n)?(...o)=>n.apply(i,o):n},t.value.isAllowedAction=!0,t}var y=class{constructor(e,t,r){this.clickHandler=()=>{};this.path=[];this.clicked=e=>{e.currentTarget===this.element&&(this.formset.currentActiveButton=this,this.clickHandler())};var s;this.formset=e,this.element=t,this.initialClass=t.getAttribute("class")??"",this.isAutoDisabled=t.hasAttribute("auto-disable"),this.decoratorElement=t.querySelector(".dj-button-decorator"),this.originalDecorator=(s=this.decoratorElement)==null?void 0:s.cloneNode(!0),this.spinnerElement=document.createElement("i"),this.spinnerElement.classList.add("dj-icon","dj-spinner"),this.spinnerElement.innerHTML=Nt,this.okayElement=document.createElement("i"),this.okayElement.classList.add("dj-icon","dj-okay"),this.okayElement.innerHTML=Gt,this.bummerElement=document.createElement("i"),this.bummerElement.classList.add("dj-icon","dj-bummer"),this.bummerElement.innerHTML=Ut,this.path=r,this.parseActionsQueue(t.getAttribute("df-click")),this.updateVisibility=this.evalVisibility("df-show",!0)??this.evalVisibility("df-hide",!1)??function(){},this.updateDisabled=this.evalDisable(),t.addEventListener("click",this.clicked)}evalVisibility(e,t){let r=this.element.getAttribute(e);if(r===null)return null;try{let s=new Function(`return ${R(r,{startRule:"OperabilityExpression"})}`);return()=>{let n=t!=!!s.call(this);this.element.hasAttribute("hidden")!==n&&this.element.toggleAttribute("hidden",n)}}catch(s){throw new Error(`Error while parsing <button df-show/hide="${r}">: ${s}.`)}}evalDisable(){let e=this.element.getAttribute("df-disable");if(!(0,k.default)(e))return()=>{};try{let t=new Function(`return ${R(e,{startRule:"OperabilityExpression"})}`);return()=>this.element.disabled=t.call(this)}catch(t){throw new Error(`Error while parsing <button df-disable="${e}">: ${t}.`)}}autoDisable(e){this.isAutoDisabled&&(this.element.disabled=!e)}disable(){return e=>(this.element.disabled=!0,Promise.resolve(e))}enable(){return e=>(this.element.disabled=!1,Promise.resolve(e))}submit(e){return()=>new Promise((t,r)=>{this.formset.submit(e).then(s=>s instanceof Response&&s.status===200?t(s):r(s))})}submitPartial(e){return()=>new Promise((t,r)=>{let s=this.path.slice(0,-1);this.formset.submitPartial(s,e).then(n=>n instanceof Response&&n.status===200?t(n):r(n))})}reset(){return e=>(this.formset.resetToInitial(),Promise.resolve(e))}reload(e){return t=>(e?location.reload():location.replace(window.location.pathname),new Promise(r=>window.setTimeout(()=>r(t),3e3)))}proceed(e){return async t=>{if((0,k.default)(e)&&e.length>0)location.href=e;else if(t instanceof Response&&t.status===200){let r=await t.clone().json();r.success_url?location.href=r.success_url:console.warn("Neither a success-, nor a proceed-URL are given.")}return new Promise(r=>window.setTimeout(()=>r(t),3e3))}}delay(e){return t=>new Promise(r=>this.timeoutHandler=window.setTimeout(()=>{this.timeoutHandler=void 0,r(t)},e))}spinner(){return e=>{var t;return(t=this.decoratorElement)==null||t.replaceChildren(this.spinnerElement),Promise.resolve(e)}}okay(e){return this.decorate(this.okayElement,e)}bummer(e){return this.decorate(this.bummerElement,e)}addClass(e){return t=>(this.element.classList.add(e),Promise.resolve(t))}removeClass(e){return t=>(this.element.classList.remove(e),Promise.resolve(t))}toggleClass(e){return t=>(this.element.classList.toggle(e),Promise.resolve(t))}emit(e,t){return r=>{let s={bubbles:!0,cancelable:!0};return t!==void 0?(Object.assign(s,{detail:t}),this.element.dispatchEvent(new CustomEvent(e,s))):this.element.dispatchEvent(new Event(e,s)),Promise.resolve(r)}}intercept(e){return t=>{let r={request:this.formset.buildBody(),response:null},s=e?document.querySelector(e):null;return s?t.clone().json().then(n=>{r.response=n,s.innerHTML=JSON.stringify(r,null,"  ")}):console.info(r),Promise.resolve(t)}}clearErrors(){return e=>(this.formset.clearErrors(),Promise.resolve(e))}scrollToError(){return e=>{let t=this.formset.findFirstErrorReport();return t&&t.scrollIntoView({behavior:"smooth"}),Promise.resolve(e)}}confirm(e){if(!(0,k.default)(e))throw new Error("The confirm() action requires a message.");return t=>window.confirm(e)?Promise.resolve(t):Promise.reject({})}alertOnError(){return e=>(e.status!==422&&window.alert(e.statusText),Promise.resolve(e))}activate(...e){return t=>(this.formset.updateOperability(this,...e),Promise.resolve(t))}setFieldValue(e,t){return r=>(this.formset.setFieldValue(e,t),Promise.resolve(r))}deletePartial(e,t){return r=>((0,k.default)(t)&&parseInt(t)&&this.formset.deletePartial(e,t),Promise.resolve(r))}prefillPartial(e){return t=>{let r=this.formset.prefillPartial(e,t);return Promise.resolve(r)}}noop(){return e=>Promise.resolve(e)}restore(){window.setTimeout(()=>this.restoreToInitial())}decorate(e,t){return r=>{var s;return(s=this.decoratorElement)==null||s.replaceChildren(e),(0,re.default)(t)?new Promise(n=>this.timeoutHandler=window.setTimeout(()=>{this.timeoutHandler=void 0,n(r)},t)):Promise.resolve(r)}}setClickHandler(e){let t=u=>d=>d instanceof te?d.func.call(this,...d.args.map(t(u)),u):d,r=u=>{let d;for(let a of u.values())d=d?d.then(async l=>{let L=l?await l.clone().json():{};return a.func.apply(this,a.args.map(t(L)))(l)}):a.func.apply(this,a.args.map(t()))();return d},s=(u,d)=>{let a;for(let l of u.values())a=a?a.then(async L=>{let z=L?await L.clone().json():{};return l.func.apply(this,l.args.map(t(z)))(L)}):l.func.apply(this,l.args.map(t()))(d);return a},n=u=>{var d,a;(a=(d=r(u.successChain))==null?void 0:d.then(()=>{this.restore.apply(this)}))==null||a.catch(l=>{var L;(L=s(u.rejectChain,l))==null||L.finally(()=>{this.restore.apply(this)})})},o=u=>{u.condition.call(this)?u.fulfilled instanceof W?n(u.fulfilled):o(u.fulfilled):u.otherwise instanceof W?n(u.otherwise):o(u.otherwise)};this.clickHandler=()=>{e instanceof W?n(e):o(e)}}parseActionsQueue(e){if(!e)return;let t=n=>{if((0,Xt.default)(n)&&(0,k.default)(n._funcName)&&Array.isArray(n._funcArgs)){let o=this[n._funcName];if(!(0,ie.default)(o)||!o.isAllowedAction)throw new Error(`Unknown function '${n._funcName}'.`);return new te(o,n._funcArgs.map(t))}return n},r=n=>{let o=n.map(t);return o.length===0&&o.push(new te(this.noop,[])),o},s=n=>n.condition===!0?new W(r(n.fulfilled.successChain),r(n.fulfilled.rejectChain)):new qe(Function(n.condition),s(n.fulfilled),s(n.otherwise));try{let n=R(e,{startRule:"Ternary"}),o=s(n);this.setClickHandler(o)}catch(n){throw new Error(`Error while parsing <button df-click="${e}">: ${n}.`)}}restoreToInitial(){var e;this.element.disabled=!1,this.element.setAttribute("class",this.initialClass),this.originalDecorator&&((e=this.decoratorElement)==null||e.replaceChildren(...this.originalDecorator.cloneNode(!0).childNodes)),this.formset.currentActiveButton=null}getDataValue(e){return this.formset.getDataValue(e)}getResponseValue(e,t){return(0,D.default)(t,e)}updateOperability(...e){this.updateVisibility(),this.updateDisabled()}abortAction(){this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)}};w([T],y.prototype,"disable",1),w([T],y.prototype,"enable",1),w([T],y.prototype,"submit",1),w([T],y.prototype,"submitPartial",1),w([T],y.prototype,"reset",1),w([T],y.prototype,"reload",1),w([T],y.prototype,"proceed",1),w([T],y.prototype,"delay",1),w([T],y.prototype,"spinner",1),w([T],y.prototype,"okay",1),w([T],y.prototype,"bummer",1),w([T],y.prototype,"addClass",1),w([T],y.prototype,"removeClass",1),w([T],y.prototype,"toggleClass",1),w([T],y.prototype,"emit",1),w([T],y.prototype,"intercept",1),w([T],y.prototype,"clearErrors",1),w([T],y.prototype,"scrollToError",1),w([T],y.prototype,"confirm",1),w([T],y.prototype,"alertOnError",1),w([T],y.prototype,"activate",1),w([T],y.prototype,"setFieldValue",1),w([T],y.prototype,"deletePartial",1),w([T],y.prototype,"prefillPartial",1),w([T],y.prototype,"noop",1),w([T],y.prototype,"getDataValue",1),w([T],y.prototype,"getResponseValue",1);var _e=class{constructor(e,t){this.form=e,this.element=t,this.updateVisibility=this.evalVisibility("df-show",!0)??this.evalVisibility("df-hide",!1)??function(){},this.updateDisabled=this.evalDisable()}evalVisibility(e,t){let r=this.element.getAttribute(e);if(r===null)return null;try{let s=new Function(`return ${R(r,{startRule:"OperabilityExpression"})}`);return()=>{let n=t!=!!s.call(this);this.element.hasAttribute("hidden")!==n&&this.element.toggleAttribute("hidden",n)}}catch(s){throw new Error(`Error while parsing <fieldset df-show/hide="${r}">: ${s}.`)}}evalDisable(){let e=this.element.getAttribute("df-disable");if(!(0,k.default)(e))return()=>{};try{let t=new Function(`return ${R(e,{startRule:"OperabilityExpression"})}`);return()=>this.element.disabled=t.call(this)}catch(t){throw new Error(`Error while parsing <fieldset df-disable="${e}">: ${t}.`)}}getDataValue(e){return this.form.getDataValue(e)}updateOperability(...e){this.updateVisibility(),this.updateDisabled()}},Be=class extends gt{constructor(e,t){super(t),this.form=e}openDialog(...e){this.element.open||(this.form.setPristine(),this.form.untouch(),e[0]instanceof y&&(0,ie.default)(e[1])&&e[1].call(e[0],this.form.path),super.openDialog(...e))}closeDialog(...e){if((0,k.default)(e[1]))switch(e[1]){case"apply":this.form.isValid()&&this.element.close("apply");break;case"close":this.element.blur(),this.element.close("close");break;case"reset":this.form.resetToInitial();break;case"clear":this.form.resetToInitial(),this.element.blur(),this.element.close("clear");break;default:break}}getDataValue(e){return this.form.getDataValue(e)}isButtonActive(e,t){let r=e[0]!==""?e:(()=>{let n=[...this.form.path],o=e.filter(d=>d!==""),u=e.length-o.length;return n.splice(n.length-u+1),n.push(...o),n})(),s=this.form.formset.buttons.find(n=>(0,G.default)(n.path,r));return t==="active"&&s===this.form.formset.currentActiveButton}},$e=class{constructor(e,t){this.errorList=null;this.errorPlaceholder=null;this.fieldGroups=Array(0);this.hiddenInputFields=Array(0);this.parentDialog=null;this.markedForRemoval=!1;this.handleSubmit=e=>{if(e.target instanceof HTMLFormElement&&e.target.method==="dialog"){this.setSubmitted();return}e.preventDefault()};this.handleReset=()=>{for(let e of this.fieldGroups)e.resetToInitial()};var n,o;this.formset=e,this.element=t,this.path=((n=this.name)==null?void 0:n.split("."))??[];let r=t.nextSibling;this.fieldset=r instanceof HTMLFieldSetElement&&r.form===t?new _e(this,r):null;let s=(o=t.nextElementSibling)==null?void 0:o.querySelector(":scope > .dj-form-errors > ul.dj-errorlist > li.dj-placeholder");if(s&&(this.errorList=s.parentElement,this.errorPlaceholder=this.errorList.removeChild(s)),this.isTransient=!!this.element.getAttribute("df-transient"),!this.isTransient){let u=t.closest("dialog");this.parentDialog=u?new Be(this,u):null}this.element.addEventListener("submit",this.handleSubmit),this.element.addEventListener("reset",this.handleReset)}aggregateValues(){let e=new Map;for(let t of this.fieldGroups)e.set(t.name,t.aggregateValue());for(let t of this.hiddenInputFields.filter(r=>r.type==="hidden"))e.set(t.name,t.value);return e}get name(){return this.element.getAttribute("name")}get formId(){return this.element.getAttribute("id")}getAbsPath(){return["formset_data",...this.path]}getDataValue(e){if(e[0]!=="")return this.formset.getDataValue(e);let t=[...this.path],r=e.filter(n=>n!==""),s=e.length-r.length;return t.splice(t.length-s+1),t.push(...r),this.formset.getDataValue(t)}setFieldValue(e,t){let r=this.fieldGroups.find(s=>s.name===e);r?r.setFieldValue(t):this.element.elements.namedItem(e)?(this.element.elements.namedItem(e).value=t,this.formset.validate()):console.warn(`Field group '${e}' not found.`)}updateOperability(...e){var t,r;(t=this.fieldset)==null||t.updateOperability(...e),this.fieldGroups.forEach(s=>s.updateOperability(...e)),(r=this.parentDialog)==null||r.updateOperability(...e)}setSubmitted(){this.fieldGroups.forEach(e=>e.setSubmitted())}validate(){this.formset.validate()}isValid(){if(this.element.noValidate)return!0;let e=!0;for(let t of this.fieldGroups)e=t.setValidationError()&&e;return e}checkValidity(){return this.element.noValidate||this.isTransient?!0:this.element.checkValidity()}reportValidity(){if(this.element.noValidate||this.isTransient)return;let e=this.element.getBoundingClientRect();(e.width!==0||e.height!==0)&&this.element.reportValidity()}clearCustomErrors(){for(;this.errorList&&this.errorList.lastChild;)this.errorList.removeChild(this.errorList.lastChild)}resetToInitial(){this.element.reset()}toggleForRemoval(e){this.markedForRemoval=e;for(let t of this.fieldGroups)e?(t.resetToInitial(),t.disableAllFields()):t.reenableAllFields()}reportCustomErrors(e){this.clearCustomErrors();let t=e.get(Re);if(this.errorList&&Array.isArray(t)&&this.errorPlaceholder)for(let r of t){let s=this.errorPlaceholder.cloneNode();s.innerHTML=r,this.errorList.appendChild(s)}for(let r of this.fieldGroups){let s=e.get(r.name);Array.isArray(s)&&s.length>0&&r.reportCustomError(s[0])}}findFirstErrorReport(){var e,t;if((e=this.errorList)!=null&&e.textContent)return this.element;for(let r of this.fieldGroups)if((t=r.errorPlaceholder)!=null&&t.textContent)return r.element;return null}untouch(){this.fieldGroups.forEach(e=>e.untouch())}setPristine(){this.fieldGroups.forEach(e=>e.setPristine())}get isPristine(){return this.fieldGroups.every(e=>e.isPristine)}disableRequiredConstraints(){this.fieldGroups.forEach(e=>e.disableRequiredConstraint())}restoreRequiredConstraints(){this.fieldGroups.forEach(e=>e.restoreRequiredConstraint())}},U=class i{constructor(e,t,r){this.forms=Array(0);this.children=Array(0);this.markedForRemoval=!1;this.formset=e,this.element=t,this.parent=r,this.findFormCollections()}findFormCollections(){for(let e of i.getChildCollections(this.element))this.children.push(new i(this.formset,e,this));for(let[e,t]of i.getChildSiblingsCollections(this.element).entries())this.children.push(new O(this.formset,t,e,this));for(let e of this.children)e.updateRemoveButtonAttrs();this.formCollectionTemplate=ve.findFormCollectionTemplate(this.formset,this.element,this)}assignForms(e){this.forms=e.filter(t=>{var r;return(r=t.element.parentElement)==null?void 0:r.isEqualNode(this.element)});for(let t of this.children)t.assignForms(e)}updateRemoveButtonAttrs(){}disconnect(){var e;this.forms.forEach(t=>this.formset.removeForm(t)),this.children.forEach(t=>t.disconnect()),(e=this.formCollectionTemplate)==null||e.disconnect(),this.element.remove()}toggleForRemoval(e){this.markedForRemoval=e;for(let t of this.forms)t.toggleForRemoval(e);for(let t of this.children)t.toggleForRemoval(e);this.formCollectionTemplate&&(this.formCollectionTemplate.markedForRemoval=e,this.formCollectionTemplate.updateAddButtonAttrs()),this.element.classList.toggle("dj-marked-for-removal",this.markedForRemoval)}resetToInitial(){if(this.toggleForRemoval(!1),i.resetCollectionsToInitial(this.children),this.formCollectionTemplate){let e=this.formCollectionTemplate.prefix,t=e==="0"?0:e.split(".").length;this.children.forEach((r,s)=>r.repositionForms(t,s)),this.formCollectionTemplate.updateAddButtonAttrs()}return!1}repositionSiblings(){}repositionForms(e,t){this.forms.forEach(r=>{r.path[e]=String(t),r.element.setAttribute("name",r.path.join("."))}),this.children.forEach(r=>r.repositionForms(e,t))}markAsFreshAndEmpty(e){this.children.forEach(t=>t.markAsFreshAndEmpty(e)),e&&this.forms.forEach(t=>t.disableRequiredConstraints())}restoreRequiredConstraint(){this.forms.forEach(e=>e.restoreRequiredConstraints()),this.children.forEach(e=>e.restoreRequiredConstraint())}get isFreshAndEmpty(){return this.forms.every(e=>e.isPristine)&&this.children.every(e=>e.isFreshAndEmpty)}removeFreshAndEmpty(){Array.from(this.children).reverse().forEach(t=>t.removeFreshAndEmpty())}static getChildCollections(e){var r;let t=(r=e.querySelector("django-form-collection"))==null?void 0:r.parentElement;return t?t.querySelectorAll(":scope > django-form-collection:not([sibling-position])"):[]}static getChildSiblingsCollections(e){var r;let t=(r=e.querySelector("django-form-collection"))==null?void 0:r.parentElement;return t?t.querySelectorAll(":scope > django-form-collection[sibling-position]"):[]}static resetCollectionsToInitial(e){var s;let t=Array(0);for(let n of e)n.resetToInitial()&&t.push(n);t.forEach(n=>e.splice(e.indexOf(n),1)),e.sort((n,o)=>n instanceof O&&o instanceof O?n.initialPosition-o.initialPosition:0);let r=null;for(let n of e)n instanceof O&&(n.initialPosition===0?(s=n.element.parentElement)==null||s.insertAdjacentElement("afterbegin",n.element):r==null||r.insertAdjacentElement("afterend",n.element),r=n.element);e.forEach(n=>n.repositionSiblings())}},O=class i extends U{constructor(t,r,s,n){super(t,r,n);this.siblingId=0;this.minSiblings=0;this.maxSiblings=null;this.justAdded=!1;this.removeCollection=()=>{var s,n;let t=((s=this.parent)==null?void 0:s.children)??this.formset.formCollections;this.justAdded?(this.disconnect(),t.splice(t.indexOf(this),1),this.repositionSiblings()):(this.toggleForRemoval(!this.markedForRemoval),this.removeButton.disabled=!this.markedForRemoval),t.forEach(o=>o.updateRemoveButtonAttrs()),(((n=this.parent)==null?void 0:n.formCollectionTemplate)??this.formset.formCollectionTemplate).updateAddButtonAttrs()};let o=r.getAttribute("sibling-position");if(!o)throw new Error("Missing argument 'sibling-position' in <django-form-collection>");this.position=this.initialPosition=parseInt(o),this.siblingId=s;let u=r.getAttribute("min-siblings");if(!u)throw new Error("Missing argument 'min-siblings' in <django-form-collection>");this.minSiblings=parseInt(u);let d=r.getAttribute("max-siblings");d&&(this.maxSiblings=parseInt(d));let a=r.querySelector(":scope > button.remove-collection");if(!a)throw new Error('<django-form-collection> with siblings requires child element <button class="remove-collection">');this.removeButton=a,this.removeButton.addEventListener("click",this.removeCollection)}disconnect(){this.removeButton.removeEventListener("click",this.removeCollection),super.disconnect()}repositionSiblings(){var r;(((r=this.parent)==null?void 0:r.children)??this.formset.formCollections).forEach((s,n)=>{s instanceof i&&(s.position=n,s.element.setAttribute("sibling-position",String(n)))})}updateRemoveButtonAttrs(){var s;if(!this.removeButton)return;let r=(((s=this.parent)==null?void 0:s.children)??this.formset.formCollections).filter(n=>!n.markedForRemoval).length;this.markedForRemoval?this.maxSiblings?this.removeButton.disabled=r>=this.maxSiblings:this.removeButton.disabled=!1:this.removeButton.disabled=r<=this.minSiblings}markAsFreshAndEmpty(t){this.justAdded=t||this.element.hasAttribute("fresh-and-empty"),super.markAsFreshAndEmpty(this.justAdded)}get isFreshAndEmpty(){return this.justAdded&&super.isFreshAndEmpty}removeFreshAndEmpty(){!this.removeButton.disabled&&this.isFreshAndEmpty?this.removeCollection():super.removeFreshAndEmpty()}resetToInitial(){return this.justAdded&&!this.element.hasAttribute("fresh-and-empty")?(this.disconnect(),!0):(super.resetToInitial(),!1)}},ve=class i{constructor(e,t,r){this.maxSiblings=null;this.baseContext=new Map;this.markedForRemoval=!1;this.resortSiblings=e=>{var n;let t=e.oldDraggableIndex??NaN,r=e.newDraggableIndex??NaN;if(!(0,re.default)(t)||!(0,re.default)(r)||t===r)return;let s=((n=this.parent)==null?void 0:n.children)??this.formset.formCollections;if(s.at(t)instanceof O){let o=s.splice(t,1);s.splice(r,0,...o),o.at(0).repositionSiblings();let u=this.prefix==="0"?0:this.prefix.split(".").length;s.forEach((d,a)=>d.repositionForms(u,a)),this.formset.validate()}};this.appendFormCollectionSibling=()=>{var d;let e=Object.fromEntries(this.baseContext),[t,r]=this.getNextPositionAndSiblingId();e.position=t.toString(),e.siblingId=r.toString(),e.position_1="${position}",e.siblingId_1="${siblingId}";for(let a=1;a<10;++a)e[`position_${a+1}`]=`\${position_${a}}`,e[`siblingId_${a+1}`]=`\${siblingId_${a}}`;let s=this.renderEmptyCollection(e);this.element.insertAdjacentHTML("beforebegin",s);let n=this.element.previousElementSibling;if(!(n instanceof HTMLElement))throw new Error("Unable to insert empty <django-form-collection> element.");let o=((d=this.parent)==null?void 0:d.children)??this.formset.formCollections,u=new O(this.formset,n,r,this.parent);o.push(u),this.formset.findForms(n),this.formset.assignFieldsToForms(n),this.formset.assignFormsToCollections(),this.formset.findCollectionErrorsList(),u.markAsFreshAndEmpty(!0),this.formset.validate(),o.forEach(a=>a.updateRemoveButtonAttrs()),this.updateAddButtonAttrs()};var d;this.formset=e,this.element=t,this.parent=r;let s=t.innerHTML.matchAll(/\$\{([^} ]+)}/g);for(let a of s)this.baseContext.set(a[1],a[0]);let n=t.getAttribute("prefix");if(!n)throw new Error('<template class="empty-collection" ...> requires attribute "prefix"');this.prefix=n,e.pushTemplatePrefix(this.prefix),this.renderEmptyCollection=(0,Kt.default)(t.innerHTML),(d=t.nextElementSibling)!=null&&d.matches("button.add-collection")&&(this.addButton=t.nextElementSibling,this.addButton.addEventListener("click",this.appendFormCollectionSibling));let o=this.element.content.querySelector("django-form-collection"),u=o==null?void 0:o.getAttribute("max-siblings");u&&(this.maxSiblings=parseInt(u)),t.hasAttribute("sortable")&&new pt(t.parentElement,{animation:150,handle:"django-form-collection[sibling-position]:not(.dj-marked-for-removal) > .collection-drag-handle",draggable:"django-form-collection[sibling-position]",selectedClass:"selected",ghostClass:"dj-ghost-collection",onEnd:this.resortSiblings})}getNextPositionAndSiblingId(){let e=-1,t=-1,r=this.parent?this.parent.children:this.formset.formCollections;for(let s of r.filter(n=>n instanceof O))e=Math.max(e,s.position),t=Math.max(t,s.siblingId);return[e+1,t+1]}disconnect(){var e;this.formset.popTemplatePrefix(this.prefix),(e=this.addButton)==null||e.removeEventListener("click",this.appendFormCollectionSibling)}updateAddButtonAttrs(){var r;if(!this.addButton)return;if(this.markedForRemoval){this.addButton.disabled=!0;return}let t=(((r=this.parent)==null?void 0:r.children)??this.formset.formCollections).filter(s=>!s.markedForRemoval).length;this.addButton.disabled=this.maxSiblings===null?!1:t>=this.maxSiblings}static findFormCollectionTemplate(e,t,r){let s=t.querySelector(":scope > .collection-siblings > template.empty-collection");if(s){let n=new i(e,s,r);return n.updateAddButtonAttrs(),n}}},Ne=class{constructor(e){this.buttons=Array(0);this.currentActiveButton=null;this.forms=Array(0);this.formCollections=Array(0);this.errorList=null;this.errorPlaceholder=null;this.collectionErrorsList=new Map;this.abortController=new AbortController;this.emptyCollectionPrefixes=Array(0);this.data={};this.element=e,this.showFeedbackMessages=this.parseWithholdFeedback(),this.CSRFToken=this.element.getAttribute("csrf-token")}connectedCallback(){this.findErrorsPlaceholder(),this.findForms(),this.findFormCollections(),this.findCollectionErrorsList(),this.assignFieldsToForms(),this.assignFormsToCollections(),this.findDetachedButtons(),this.formCollections.forEach(e=>e.markAsFreshAndEmpty()),window.setTimeout(()=>this.validate(),0)}get endpoint(){return this.element.getAttribute("endpoint")??""}get forceSubmission(){return this.element.hasAttribute("force-submission")}parseWithholdFeedback(){var s;let e=!0,t=((s=this.element.getAttribute("withhold-feedback"))==null?void 0:s.split(" "))??[],r=new Set(["dj-feedback-errors","dj-feedback-warnings","dj-feedback-success"]);for(let n of t)switch(n.toLowerCase()){case"messages":e=!1;break;case"errors":r.delete("dj-feedback-errors");break;case"warnings":r.delete("dj-feedback-warnings");break;case"success":r.delete("dj-feedback-success");break;default:throw new Error(`Unknown value in <django-formset withhold-feedback="${n}">.`)}return r.forEach(n=>this.element.classList.add(n)),e}pushTemplatePrefix(e){this.emptyCollectionPrefixes.push(e)}popTemplatePrefix(e){let t=this.emptyCollectionPrefixes.indexOf(e);t>=0&&this.emptyCollectionPrefixes.splice(t,1)}assignFieldsToForms(e){e=e??this.element;for(let t of e.querySelectorAll("INPUT, SELECT, TEXTAREA, BUTTON")){let r=t.getAttribute("form");if(!r)continue;let s=this.forms.filter(o=>o.formId&&o.formId===r);if(s.length<1)continue;if(s.length>1)throw new Error(`More than one form has id="${r}"`);let n=s[0];if(t instanceof HTMLInputElement&&t.type==="hidden")n.hiddenInputFields.includes(t)||n.hiddenInputFields.push(t);else if(t instanceof HTMLButtonElement){if(t.hasAttribute("df-click")&&t.form===n.element){let o=new y(n.formset,t,[...n.path,t.name]);this.buttons.push(o)}}else{let o=t.closest('[role="group"]');o&&!n.fieldGroups.find(u=>u.element===o)&&n.fieldGroups.push(new Ve(n,o))}}}findErrorsPlaceholder(){let e=this.element.querySelector(":scope > .dj-form-errors > ul.dj-errorlist > li.dj-placeholder");e&&(this.errorList=e.parentElement,this.errorPlaceholder=this.errorList.removeChild(e))}findForms(e){e=e??this.element;for(let t of e.getElementsByTagName("FORM")){let r=new $e(this,t);this.forms.push(r)}this.checkForUniqueness()}checkForUniqueness(){let e=this.forms.filter(r=>!r.isTransient);if(e.length===1)return;let t=Array();e.forEach(r=>{if(!r.name)throw new Error("Multiple <form>-elements in a <django-formset> require a unique name each.");if(r.name in t)throw new Error(`Duplicate name "${r.name}" used in multiple forms of same <django-formset>.`);t.push(r.name)})}findFormCollections(){for(let e of U.getChildCollections(this.element))this.formCollections.push(new U(this,e));for(let[e,t]of U.getChildSiblingsCollections(this.element).entries())this.formCollections.push(new O(this,t,e));this.formCollections.forEach(e=>e.updateRemoveButtonAttrs()),this.formCollectionTemplate=ve.findFormCollectionTemplate(this,this.element)}findCollectionErrorsList(){this.collectionErrorsList.clear();for(let e of this.element.getElementsByClassName("dj-collection-errors")){let t=e.getAttribute("prefix")??"",r=e.querySelector("ul.dj-errorlist");this.collectionErrorsList.set(t,r)}}findDetachedButtons(){for(let e of this.element.getElementsByTagName("BUTTON"))if(e.hasAttribute("df-click")){let t=e;if(!this.buttons.find(r=>r.element===t)){let r=t.name?[t.name]:[];this.buttons.push(new y(this,t,r))}}}assignFormsToCollections(){this.formCollections.forEach(e=>e.assignForms(this.forms))}removeForm(e){this.forms.splice(this.forms.indexOf(e),1)}removeFreshCollections(){Array.from(this.formCollections).reverse().forEach(t=>t.removeFreshAndEmpty())}aggregateValues(){this.data={};for(let e of this.forms)(0,Oe.default)(this.data,e.getAbsPath(),Object.fromEntries(e.aggregateValues()));this.updateOperability()}updateOperability(...e){for(let t of this.forms)t.markedForRemoval||t.updateOperability(...e);for(let t of this.buttons)t.updateOperability(...e)}validate(){let e=!0;for(let t of this.forms)e=(t.markedForRemoval||t.checkValidity())&&e;for(let t of this.buttons)t.autoDisable(e);return this.aggregateValues(),e}buildBody(e){let t;function r(n,o){if(o.length===1){Array.isArray(n)?t&&!n.includes(t)&&n.push(t):n[o[0]]=t??[];return}if(isNaN(parseInt(o[1]))){let u=n[o[0]]??{};r(u,o.slice(1));let d=parseInt(o[0]);isNaN(d)?n[o[0]]=u:n[d]={...n[d],...u}}else{if(Array.isArray(n))throw new Error("Invalid form structure: Contains nested arrays.");let u=n[o[0]]??[];if(!Array.isArray(u))throw new Error("Invalid form structure: Inner array is missing.");r(u,o.slice(1)),n[o[0]]=u}}let s={};for(let n of this.emptyCollectionPrefixes){let o=["formset_data",...n.split(".")];t=(0,D.default)(s,o),r(s,o)}for(let n of this.forms){if(!n.name){let u=Object.fromEntries(n.aggregateValues());return Object.assign({},{formset_data:u},{_extra:e})}if(n.isTransient)continue;let o=n.getAbsPath();t=(0,D.default)(this.data,o),n.markedForRemoval&&(t[Qi]=!0),r(s,o)}return Object.assign({},s,{_extra:e})}async submit(e){var r;let t=!0;if(this.setSubmitted(),!this.forceSubmission)for(let s of this.forms)s.markedForRemoval||s.isTransient||((r=s.parentDialog)==null?void 0:r.isOpen())===!1||(t=s.isValid()&&t);if(t){if(!this.endpoint)throw new Error(`<django-formset> requires attribute 'endpoint="server endpoint"' for submission`);this.removeFreshCollections();let s=this.buildBody(e);try{let n=new Headers;n.append("Accept","application/json"),n.append("Content-Type","application/json"),this.CSRFToken&&n.append("X-CSRFToken",this.CSRFToken);let o=await fetch(this.endpoint,{method:"POST",headers:n,body:JSON.stringify(s),signal:this.abortController.signal});switch(o.status){case 200:return this.clearErrors(),this.forms.forEach(d=>d.element.dispatchEvent(new Event("submitted"))),o;case 422:this.clearErrors();let u=await o.clone().json();return this.reportErrors(u),o;default:return console.warn(`Unknown response status: ${o.status}`),this.clearErrors(),this.buttons.forEach(d=>d.restoreToInitial()),o}}catch(n){this.clearErrors(),this.buttons.forEach(o=>o.restoreToInitial()),alert(n)}}else{this.clearErrors();for(let s of this.forms)s.reportValidity()}}async prefillPartial(e,t){if(!this.endpoint)throw new Error(`<django-formset> requires attribute 'endpoint="server endpoint"' for submission`);try{let r=new URLSearchParams({pk:e,path:t.join(".")}),s=new Headers;s.append("Accept","application/json");let n=await fetch(`${this.endpoint}?${r.toString()}`,{headers:s});switch(n.status){case 200:this.clearErrors();let o=await n.json(),u=this.forms.find(d=>(0,G.default)(d.path,t));if(u!=null&&u.element)for(let[d,a]of Object.entries((0,D.default)(o,t,{}))){let l=u.element.elements.namedItem(d);((0,k.default)(a)||(0,re.default)(a))&&(l instanceof HTMLInputElement||l instanceof HTMLSelectElement||l instanceof HTMLTextAreaElement)&&(l.value=a)}return n;default:return console.warn(`Unknown response status: ${n.status}`),this.clearErrors(),this.buttons.forEach(d=>d.restoreToInitial()),n}}catch(r){this.clearErrors(),this.buttons.forEach(s=>s.restoreToInitial()),alert(r)}}async submitPartial(e,t){var n;if(!this.endpoint)throw new Error(`<django-formset> requires attribute 'endpoint="server endpoint"' for submission`);(n=this.forms.find(o=>(0,G.default)(o.path,e)))==null||n.setSubmitted();let r=["formset_data",...e],s=(0,Oe.default)({},r,(0,D.default)(this.buildBody(t),r));try{let o=new Headers;o.append("Accept","application/json"),o.append("Content-Type","application/json"),this.CSRFToken&&o.append("X-CSRFToken",this.CSRFToken);let u=await fetch(this.endpoint,{method:"PATCH",headers:o,body:JSON.stringify(s)});switch(u.status){case 200:return this.clearErrors(),this.forms.filter(a=>(0,G.default)(a.path,e)).forEach(a=>{a.element.dispatchEvent(new Event("submitted"))}),u;case 422:this.clearErrors();let d=await u.clone().json();return this.reportErrors(d),u;default:return console.warn(`Unknown response status: ${u.status}`),this.clearErrors(),this.buttons.forEach(a=>a.restoreToInitial()),u}}catch(o){this.clearErrors(),this.buttons.forEach(u=>u.restoreToInitial()),alert(o)}}async deletePartial(e,t){if(!this.endpoint)throw new Error(`<django-formset> requires attribute 'endpoint="server endpoint"' for submission`);try{let r=new URLSearchParams({pk:t,path:e.join(".")}),s=new Headers;this.CSRFToken&&s.append("X-CSRFToken",this.CSRFToken);let n=await fetch(`${this.endpoint}?${r.toString()}`,{method:"DELETE",headers:s});switch(n.status){case 204:return this.clearErrors(),n;default:return console.warn(`Unknown response status: ${n.status}`),this.clearErrors(),this.buttons.forEach(o=>o.restoreToInitial()),n}}catch(r){this.clearErrors(),this.buttons.forEach(s=>s.restoreToInitial()),alert(r)}}reportErrors(e){console.info("Response from server:",e);for(let t of this.forms){let r=t.name?(0,D.default)(e,t.name.split("."),null):e;(0,Jt.default)(r)?t.clearCustomErrors():(t.reportCustomErrors(new Map(Object.entries(r))),t.reportValidity())}for(let[t,r]of this.collectionErrorsList){let s=t?t.split("."):[];s=[...s,"0",Wi];for(let n of(0,D.default)(e,s,[])){let o=document.createElement("li");o.classList.add("dj-placeholder"),o.innerText=n,r.appendChild(o)}}if(this.errorList&&this.errorPlaceholder&&Array.isArray(e[Re]))for(let t of e[Re]){let r=this.errorPlaceholder.cloneNode();r.innerHTML=t,this.errorList.appendChild(r)}}resetToInitial(){var e;U.resetCollectionsToInitial(this.formCollections),(e=this.formCollectionTemplate)==null||e.updateAddButtonAttrs(),this.forms.forEach(t=>t.resetToInitial()),this.validate()}abort(){for(let e of this.buttons)e.abortAction();this.abortController.abort()}setSubmitted(){for(let e of this.forms)e.setSubmitted()}getDataValue(e){let t=["formset_data",...e];return(0,D.default)(this.data,t)}setFieldValue(e,t){let r=e.slice(0,-1),s=this.forms.find(n=>(0,G.default)(n.path,r));s&&e.length>0&&s.setFieldValue(e.slice(-1)[0],t)}findFirstErrorReport(){for(let e of this.forms){let t=e.findFirstErrorReport();if(t)return t}return null}clearErrors(){for(let e of this.forms)e.clearCustomErrors();for(let e of this.collectionErrorsList.values())for(;e.firstElementChild;)e.removeChild(e.firstElementChild);this.errorList&&this.errorList.replaceChildren()}},K=Symbol("DjangoFormset"),zt,Ee=class extends(zt=HTMLElement,K,zt){constructor(){super(),this[K]=new Ne(this)}static get observedAttributes(){return["endpoint","withhold-feedback","force-submission"]}connectedCallback(){this[K].connectedCallback()}async submit(e){return this[K].submit(e)}async abort(){return this[K].abort()}async reset(){return this[K].resetToInitial()}};window.addEventListener("DOMContentLoaded",i=>{let e=mt.convertPseudoClasses(),t=Array();function r(o,u,d,a=void 0){window.customElements.whenDefined(u).then(()=>o()),window.customElements.get(u)instanceof Function||window.customElements.define(u,d,a)}function s(o,u=!1){o.querySelector('select[is="django-selectize"]')&&t.push(new Promise((d,a)=>{import("./DjangoSelectize-6XCBY3D6.js").then(({DjangoSelectizeElement:l})=>{r(d,"django-selectize",l,{extends:"select"})}).catch(l=>a(l))})),o.querySelector('select[is="django-country-selectize"]')&&t.push(new Promise((d,a)=>{import("./CountrySelectize-ENN6HSL2.js").then(({CountrySelectizeElement:l})=>{r(d,"django-country-selectize",l,{extends:"select"})}).catch(l=>a(l))})),o.querySelector('select[is="django-dual-selector"], django-sortable-select')&&t.push(new Promise((d,a)=>{import("./DualSelector-NWEURT22.js").then(({DualSelectorElement:l,SortableSelectElement:L})=>{Promise.all([window.customElements.whenDefined("django-sortable-select"),window.customElements.whenDefined("django-dual-selector")]).then(()=>d()),window.customElements.get("django-sortable-select")instanceof Function||window.customElements.define("django-sortable-select",L),window.customElements.get("django-dual-selector")instanceof Function||window.customElements.define("django-dual-selector",l,{extends:"select"})}).catch(l=>a(l))})),o.querySelector('input[is="django-phone-number"]')&&t.push(new Promise((d,a)=>{import("./PhoneNumber-ZPXL2I3V.js").then(({PhoneNumberElement:l})=>{r(d,"django-phone-number",l,{extends:"input"})}).catch(l=>a(l))})),o.querySelector('textarea[is="django-richtext"]')&&t.push(new Promise((d,a)=>{import("./RichtextArea-2WHCQ2VL.js").then(({RichTextAreaElement:l})=>{let L=o.querySelectorAll('textarea[is="django-richtext"]');window.customElements.whenDefined("django-richtext").then(()=>{Promise.all(Array.from(L).map(z=>new Promise(ne=>{u||z.isInitialized?ne():z.addEventListener("connected",()=>ne(),{once:!0})}))).then(()=>d())}).then(()=>d()),window.customElements.get("django-richtext")instanceof Function||window.customElements.define("django-richtext",l,{extends:"textarea"})}).catch(l=>a(l))})),o.querySelector('input[is="django-slug"]')&&t.push(new Promise((d,a)=>{import("./DjangoSlug-L4JA4C7X.js").then(({DjangoSlugElement:l})=>{r(d,"django-slug",l,{extends:"input"})}).catch(l=>a(l))})),o.querySelector('input[is="django-datefield"]')&&t.push(new Promise((d,a)=>{import("./DateTime-ZJ2PCIMT.js").then(({DateFieldElement:l})=>{r(d,"django-datefield",l,{extends:"input"})}).catch(l=>a(l))})),o.querySelector('input[is="django-datecalendar"]')&&t.push(new Promise((d,a)=>{import("./Calendar-YVDJQ7L5.js").then(({DateCalendarElement:l})=>{r(d,"django-datecalendar",l,{extends:"input"})}).catch(l=>a(l))})),o.querySelector('input[is="django-datepicker"]')&&t.push(new Promise((d,a)=>{import("./DateTime-ZJ2PCIMT.js").then(({DatePickerElement:l})=>{r(d,"django-datepicker",l,{extends:"input"})}).catch(l=>a(l))})),o.querySelector('input[is="django-datetimefield"]')&&t.push(new Promise((d,a)=>{import("./DateTime-ZJ2PCIMT.js").then(({DateTimeFieldElement:l})=>{r(d,"django-datetimefield",l,{extends:"input"})}).catch(l=>a(l))})),o.querySelector('input[is="django-datetimecalendar"]')&&t.push(new Promise((d,a)=>{import("./Calendar-YVDJQ7L5.js").then(({DateTimeCalendarElement:l})=>{r(d,"django-datetimecalendar",l,{extends:"input"})}).catch(l=>a(l))})),o.querySelector('input[is="django-datetimepicker"]')&&t.push(new Promise((d,a)=>{import("./DateTime-ZJ2PCIMT.js").then(({DateTimePickerElement:l})=>{r(d,"django-datetimepicker",l,{extends:"input"})}).catch(l=>a(l))})),o.querySelector('input[is="django-daterangefield"]')&&t.push(new Promise((d,a)=>{import("./DateTime-ZJ2PCIMT.js").then(({DateRangeFieldElement:l})=>{r(d,"django-daterangefield",l,{extends:"input"})}).catch(l=>a(l))})),o.querySelector('input[is="django-daterangecalendar"]')&&t.push(new Promise((d,a)=>{import("./Calendar-YVDJQ7L5.js").then(({DateRangeCalendarElement:l})=>{r(d,"django-daterangecalendar",l,{extends:"input"})}).catch(l=>a(l))})),o.querySelector('input[is="django-daterangepicker"]')&&t.push(new Promise((d,a)=>{import("./DateTime-ZJ2PCIMT.js").then(({DateRangePickerElement:l})=>{r(d,"django-daterangepicker",l,{extends:"input"})}).catch(l=>a(l))})),o.querySelector('input[is="django-datetimerangefield"]')&&t.push(new Promise((d,a)=>{import("./DateTime-ZJ2PCIMT.js").then(({DateTimeRangeFieldElement:l})=>{r(d,"django-datetimerangefield",l,{extends:"input"})}).catch(l=>a(l))})),o.querySelector('input[is="django-datetimerangecalendar"]')&&t.push(new Promise((d,a)=>{import("./Calendar-YVDJQ7L5.js").then(({DateTimeRangeCalendarElement:l})=>{r(d,"django-datetimerangecalendar",l,{extends:"input"})}).catch(l=>a(l))})),o.querySelector('input[is="django-datetimerangepicker"]')&&t.push(new Promise((d,a)=>{import("./DateTime-ZJ2PCIMT.js").then(({DateTimeRangePickerElement:l})=>{r(d,"django-datetimerangepicker",l,{extends:"input"})}).catch(l=>a(l))}))}document.querySelectorAll("template.empty-collection").forEach(o=>{o instanceof HTMLTemplateElement&&o.content instanceof DocumentFragment&&s(o.content,!0)}),s(document);let n=new Set;document.querySelectorAll("django-formset [id]").forEach(o=>{let u=o.getAttribute("id");if(n.has(u))throw new Error(`There are at least two elements with attribute id="${u}"`);n.add(u)}),Promise.all(t).then(()=>{window.customElements.define("django-formset",Ee),window.customElements.whenDefined("django-formset").then(()=>{e.remove()})}).catch(o=>console.error(`Failed to initialize django-formset: ${o}`))});
/*! Bundled license information:

@ungap/custom-elements/index.js:
  (*! (c) Andrea Giammarchi @webreflection ISC *)
  (*! (c) Andrea Giammarchi - ISC *)
*/
